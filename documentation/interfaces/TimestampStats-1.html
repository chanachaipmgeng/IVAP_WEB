<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>frontend documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">frontend documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">

















<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  TimestampStats</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/services/timestamp.service.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#averageCheckinTime" 
>
                                            averageCheckinTime
                                        </a>
                                </li>
                                <li>
                                        <a href="#averageCheckoutTime" 
>
                                            averageCheckoutTime
                                        </a>
                                </li>
                                <li>
                                        <a href="#earlyCheckouts" 
>
                                            earlyCheckouts
                                        </a>
                                </li>
                                <li>
                                        <a href="#lateCheckins" 
>
                                            lateCheckins
                                        </a>
                                </li>
                                <li>
                                        <a href="#pendingApprovals" 
>
                                            pendingApprovals
                                        </a>
                                </li>
                                <li>
                                        <a href="#thisMonthRecords" 
>
                                            thisMonthRecords
                                        </a>
                                </li>
                                <li>
                                        <a href="#thisWeekRecords" 
>
                                            thisWeekRecords
                                        </a>
                                </li>
                                <li>
                                        <a href="#todayRecords" 
>
                                            todayRecords
                                        </a>
                                </li>
                                <li>
                                        <a href="#totalRecords" 
>
                                            totalRecords
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="averageCheckinTime"></a>
                                        <span class="name "><b>averageCheckinTime</b>
                                            <a href="#averageCheckinTime">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>averageCheckinTime:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="averageCheckoutTime"></a>
                                        <span class="name "><b>averageCheckoutTime</b>
                                            <a href="#averageCheckoutTime">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>averageCheckoutTime:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="earlyCheckouts"></a>
                                        <span class="name "><b>earlyCheckouts</b>
                                            <a href="#earlyCheckouts">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>earlyCheckouts:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lateCheckins"></a>
                                        <span class="name "><b>lateCheckins</b>
                                            <a href="#lateCheckins">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lateCheckins:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="pendingApprovals"></a>
                                        <span class="name "><b>pendingApprovals</b>
                                            <a href="#pendingApprovals">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>pendingApprovals:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="thisMonthRecords"></a>
                                        <span class="name "><b>thisMonthRecords</b>
                                            <a href="#thisMonthRecords">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>thisMonthRecords:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="thisWeekRecords"></a>
                                        <span class="name "><b>thisWeekRecords</b>
                                            <a href="#thisWeekRecords">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>thisWeekRecords:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="todayRecords"></a>
                                        <span class="name "><b>todayRecords</b>
                                            <a href="#todayRecords">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>todayRecords:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="totalRecords"></a>
                                        <span class="name "><b>totalRecords</b>
                                            <a href="#totalRecords">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>totalRecords:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, signal, computed } from &#x27;@angular/core&#x27;;
import { Observable } from &#x27;rxjs&#x27;;
import { map } from &#x27;rxjs/operators&#x27;;
import { ApiService } from &#x27;./api.service&#x27;;
import { UUID, PaginatedResponse } from &#x27;../models/base.model&#x27;;
import { EmployeeTimestamp, EmployeeTimestampCreate, EmployeeTimestampUpdate } from &#x27;../models/timestamp.model&#x27;;

export interface TimestampRecord {
  id: string;
  userId: string;
  userName: string;
  type: &#x27;checkin&#x27; | &#x27;checkout&#x27; | &#x27;break_start&#x27; | &#x27;break_end&#x27; | &#x27;overtime_start&#x27; | &#x27;overtime_end&#x27;;
  timestamp: Date;
  location: {
    latitude: number;
    longitude: number;
    address?: string;
    accuracy?: number;
  };
  photo?: {
    data: string; // base64
    timestamp: Date;
    location?: {
      latitude: number;
      longitude: number;
    };
  };
  deviceInfo: {
    userAgent: string;
    platform: string;
    language: string;
  };
  status: &#x27;pending&#x27; | &#x27;approved&#x27; | &#x27;rejected&#x27; | &#x27;auto_approved&#x27;;
  notes?: string;
  createdAt: Date;
  updatedAt: Date;
}

export interface LocationSettings {
  id: string;
  name: string;
  address: string;
  coordinates: {
    latitude: number;
    longitude: number;
  };
  radius: number; // in meters
  isActive: boolean;
  allowedTypes: TimestampRecord[&#x27;type&#x27;][];
  workingHours: {
    start: string; // HH:mm format
    end: string; // HH:mm format
    days: number[]; // 0-6 (Sunday-Saturday)
  };
  timezone: string;
}

export interface GeofenceEvent {
  id: string;
  userId: string;
  locationId: string;
  eventType: &#x27;enter&#x27; | &#x27;exit&#x27;;
  timestamp: Date;
  coordinates: {
    latitude: number;
    longitude: number;
  };
  accuracy: number;
}

export interface TimestampStats {
  totalRecords: number;
  todayRecords: number;
  thisWeekRecords: number;
  thisMonthRecords: number;
  pendingApprovals: number;
  averageCheckinTime: string;
  averageCheckoutTime: string;
  lateCheckins: number;
  earlyCheckouts: number;
}

/**
 * Timestamp Filters for API queries
 */
export interface TimestampFilters {
  search?: string;
  company_employee_id?: UUID;
  start_date?: string;  // ISO datetime string
  end_date?: string;  // ISO datetime string
  timestamp_type?: string;  // CHECK_IN, CHECK_OUT, etc.
  page?: number;
  size?: number;
  sort?: string;
}

@Injectable({
  providedIn: &#x27;root&#x27;
})
export class TimestampService {
  // Client-side storage (for backward compatibility)
  private timestampsMap: Map&lt;string, TimestampRecord&gt; &#x3D; new Map();
  private locationsMap: Map&lt;string, LocationSettings&gt; &#x3D; new Map();
  private geofenceEventsMap: Map&lt;string, GeofenceEvent&gt; &#x3D; new Map();

  // ✅ Signals for reactive state
  private _timestamps &#x3D; signal&lt;TimestampRecord[]&gt;([]);
  private _locations &#x3D; signal&lt;LocationSettings[]&gt;([]);
  private _geofenceEvents &#x3D; signal&lt;GeofenceEvent[]&gt;([]);
  private _stats &#x3D; signal&lt;TimestampStats&gt;(this.getInitialStats());

  // ✅ Readonly signals for public access
  public readonly timestamps &#x3D; this._timestamps.asReadonly();
  public readonly locations &#x3D; this._locations.asReadonly();
  public readonly geofenceEvents &#x3D; this._geofenceEvents.asReadonly();
  public readonly stats &#x3D; this._stats.asReadonly();

  // ✅ Computed signals for derived state
  public readonly timestampsCount &#x3D; computed(() &#x3D;&gt; this._timestamps().length);
  public readonly todayTimestampsCount &#x3D; computed(() &#x3D;&gt; {
    const today &#x3D; new Date();
    today.setHours(0, 0, 0, 0);
    return this._timestamps().filter(t &#x3D;&gt; new Date(t.timestamp) &gt;&#x3D; today).length;
  });
  public readonly pendingApprovalsCount &#x3D; computed(() &#x3D;&gt;
    this._timestamps().filter(t &#x3D;&gt; t.status &#x3D;&#x3D;&#x3D; &#x27;pending&#x27;).length
  );
  public readonly locationsCount &#x3D; computed(() &#x3D;&gt; this._locations().length);
  public readonly activeLocationsCount &#x3D; computed(() &#x3D;&gt;
    this._locations().filter(l &#x3D;&gt; l.isActive).length
  );
  public readonly geofenceEventsCount &#x3D; computed(() &#x3D;&gt; this._geofenceEvents().length);

  // ✅ Observable compatibility layer (for backward compatibility)
  public timestamps$ &#x3D; new Observable&lt;TimestampRecord[]&gt;(observer &#x3D;&gt; {
    observer.next(this._timestamps());
    // Note: This is a compatibility layer - prefer using signals directly
  });
  public locations$ &#x3D; new Observable&lt;LocationSettings[]&gt;(observer &#x3D;&gt; {
    observer.next(this._locations());
    // Note: This is a compatibility layer - prefer using signals directly
  });
  public geofenceEvents$ &#x3D; new Observable&lt;GeofenceEvent[]&gt;(observer &#x3D;&gt; {
    observer.next(this._geofenceEvents());
    // Note: This is a compatibility layer - prefer using signals directly
  });
  public stats$ &#x3D; new Observable&lt;TimestampStats&gt;(observer &#x3D;&gt; {
    observer.next(this._stats());
    // Note: This is a compatibility layer - prefer using signals directly
  });

  // Location tracking
  private watchId: number | null &#x3D; null;
  private currentLocation: GeolocationPosition | null &#x3D; null;
  private locationUpdateInterval: any &#x3D; null;

  constructor(private api?: ApiService) {
    this.initializeDefaultLocations();
    this.startLocationTracking();
    this.loadStoredData();
  }

  // &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Backend API Functions &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;

  /**
   * Get timestamps with pagination
   * Backend: GET /api/v1/timestamps/company/{company_id}
   */
  public getTimestamps(companyId: UUID, filters?: TimestampFilters): Observable&lt;PaginatedResponse&lt;EmployeeTimestamp&gt;&gt; {
    if (!this.api) {
      throw new Error(&#x27;ApiService is not available&#x27;);
    }
    const options &#x3D; { skipTransform: true };
    return this.api.get&lt;any&gt;(&#x60;/timestamps/company/${companyId}&#x60;, filters, options).pipe(
      map((response: any) &#x3D;&gt; {
        const data &#x3D; response?.data || response?.items || [];
        return {
          ...response,
          data: data.map((item: any) &#x3D;&gt; this.transformBackendToEmployeeTimestamp(item))
        };
      })
    );
  }

  /**
   * Get timestamp by ID
   * Backend: GET /api/v1/timestamps/company/{company_id}/{timestamp_id}
   */
  public getTimestampById(companyId: UUID, timestampId: UUID): Observable&lt;EmployeeTimestamp&gt; {
    if (!this.api) {
      throw new Error(&#x27;ApiService is not available&#x27;);
    }
    const options &#x3D; { skipTransform: true };
    return this.api.get&lt;any&gt;(&#x60;/timestamps/company/${companyId}/${timestampId}&#x60;, undefined, options).pipe(
      map((response: any) &#x3D;&gt; this.transformBackendToEmployeeTimestamp(response?.data || response))
    );
  }

  /**
   * Create timestamp
   * Backend: POST /api/v1/timestamps/company/{company_id}
   */
  public createTimestamp(companyId: UUID, data: EmployeeTimestampCreate): Observable&lt;EmployeeTimestamp&gt; {
    if (!this.api) {
      throw new Error(&#x27;ApiService is not available&#x27;);
    }
    // Transform frontend format to backend format
    const backendData &#x3D; this.transformCreateToBackend(data);
    const options &#x3D; { skipTransform: true };
    return this.api.post&lt;any&gt;(&#x60;/timestamps/company/${companyId}&#x60;, backendData, undefined, options).pipe(
      map((response: any) &#x3D;&gt; this.transformBackendToEmployeeTimestamp(response?.data || response))
    );
  }

  /**
   * Update timestamp
   * Backend: PUT /api/v1/timestamps/company/{company_id}/{timestamp_id}
   */
  public updateTimestamp(companyId: UUID, timestampId: UUID, data: EmployeeTimestampUpdate): Observable&lt;EmployeeTimestamp&gt; {
    if (!this.api) {
      throw new Error(&#x27;ApiService is not available&#x27;);
    }
    // Transform frontend format to backend format
    const backendData &#x3D; this.transformUpdateToBackend(data);
    const options &#x3D; { skipTransform: true };
    return this.api.put&lt;any&gt;(&#x60;/timestamps/company/${companyId}/${timestampId}&#x60;, backendData, undefined, options).pipe(
      map((response: any) &#x3D;&gt; this.transformBackendToEmployeeTimestamp(response?.data || response))
    );
  }

  /**
   * Delete timestamp
   * Backend: DELETE /api/v1/timestamps/company/{company_id}/{timestamp_id}
   */
  public deleteTimestamp(companyId: UUID, timestampId: UUID): Observable&lt;void&gt; {
    if (!this.api) {
      throw new Error(&#x27;ApiService is not available&#x27;);
    }
    const options &#x3D; { skipTransform: true };
    return this.api.delete&lt;void&gt;(&#x60;/timestamps/company/${companyId}/${timestampId}&#x60;, undefined, options);
  }

  /**
   * Approve timestamp
   * Backend: POST /api/v1/timestamps/company/{company_id}/{timestamp_id}/approve
   */
  public approveTimestamp(companyId: UUID, timestampId: UUID): Observable&lt;EmployeeTimestamp&gt; {
    if (!this.api) {
      throw new Error(&#x27;ApiService is not available&#x27;);
    }
    const options &#x3D; { skipTransform: true };
    return this.api.post&lt;any&gt;(&#x60;/timestamps/company/${companyId}/${timestampId}/approve&#x60;, {}, undefined, options).pipe(
      map((response: any) &#x3D;&gt; this.transformBackendToEmployeeTimestamp(response?.data || response))
    );
  }

  /**
   * Reject timestamp
   * Backend: POST /api/v1/timestamps/company/{company_id}/{timestamp_id}/reject
   * Backend expects EmployeeTimestampStatusUpdate with status&#x3D;&#x27;rejected&#x27; and rejection_reason
   */
  public rejectTimestamp(companyId: UUID, timestampId: UUID, reason: string): Observable&lt;EmployeeTimestamp&gt; {
    if (!this.api) {
      throw new Error(&#x27;ApiService is not available&#x27;);
    }
    const options &#x3D; { skipTransform: true };
    // Backend expects EmployeeTimestampStatusUpdate schema
    return this.api.post&lt;any&gt;(&#x60;/timestamps/company/${companyId}/${timestampId}/reject&#x60;, {
      status: &#x27;rejected&#x27;,
      rejection_reason: reason || &#x27;No reason provided&#x27;
    }, undefined, options).pipe(
      map((response: any) &#x3D;&gt; this.transformBackendToEmployeeTimestamp(response?.data || response))
    );
  }

  /**
   * Bulk approve timestamps
   * Backend: POST /api/v1/timestamps/company/{company_id}/bulk-approve
   */
  public bulkApproveTimestamps(companyId: UUID, timestampIds: UUID[]): Observable&lt;EmployeeTimestamp[]&gt; {
    if (!this.api) {
      throw new Error(&#x27;ApiService is not available&#x27;);
    }
    const options &#x3D; { skipTransform: true };
    return this.api.post&lt;any[]&gt;(&#x60;/timestamps/company/${companyId}/bulk-approve&#x60;, timestampIds, undefined, options).pipe(
      map((response: any) &#x3D;&gt; {
        const data &#x3D; response?.data || response || [];
        return Array.isArray(data) ? data.map((item: any) &#x3D;&gt; this.transformBackendToEmployeeTimestamp(item)) : [];
      })
    );
  }

  /**
   * Export timestamps
   * Backend: GET /api/v1/timestamps/company/{company_id}/export
   */
  public exportTimestamps(companyId: UUID, filters?: TimestampFilters): Observable&lt;Blob&gt; {
    if (!this.api) {
      throw new Error(&#x27;ApiService is not available&#x27;);
    }
    const options &#x3D; { skipTransform: true, responseType: &#x27;blob&#x27; as &#x27;json&#x27; };
    return this.api.get&lt;Blob&gt;(&#x60;/timestamps/company/${companyId}/export&#x60;, filters, options);
  }

  /**
   * Transform EmployeeTimestampCreate to backend format
   * Backend expects snake_case: company_employee_id, timestamp_type, location_name, photo_timestamp
   */
  private transformCreateToBackend(data: EmployeeTimestampCreate): any {
    // Map frontend timestampType to backend format
    const backendTimestampType &#x3D; this.mapTimestampTypeToBackend(data.timestampType);

    return {
      company_employee_id: data.companyEmployeeId,  // snake_case for backend
      timestamp_type: backendTimestampType,  // snake_case for backend
      location_name: data.locationName,  // snake_case for backend
      latitude: data.latitude,
      longitude: data.longitude,
      photo_timestamp: data.photoTimestamp  // snake_case for backend
    };
  }

  /**
   * Map frontend TimestampType to backend format
   */
  private mapTimestampTypeToBackend(type: string): string {
    const typeMap: Record&lt;string, string&gt; &#x3D; {
      &#x27;checkin&#x27;: &#x27;CHECK_IN&#x27;,
      &#x27;checkout&#x27;: &#x27;CHECK_OUT&#x27;,
      &#x27;break_start&#x27;: &#x27;WARNING&#x27;,
      &#x27;break_end&#x27;: &#x27;WARNING&#x27;,
      &#x27;overtime_start&#x27;: &#x27;WARNING&#x27;,
      &#x27;overtime_end&#x27;: &#x27;WARNING&#x27;
    };
    return typeMap[type] || type.toUpperCase();
  }

  /**
   * Map backend TimestampType to frontend format
   */
  private mapBackendToTimestampType(type: string): EmployeeTimestamp[&#x27;timestampType&#x27;] {
    // Backend uses: CHECK_IN, CHECK_OUT, WARNING, DISAPPROVE
    // Map to TimestampType union type
    const validTypes: EmployeeTimestamp[&#x27;timestampType&#x27;][] &#x3D; [&#x27;CHECK_IN&#x27;, &#x27;CHECK_OUT&#x27;, &#x27;WARNING&#x27;, &#x27;DISAPPROVE&#x27;];
    if (validTypes.includes(type as EmployeeTimestamp[&#x27;timestampType&#x27;])) {
      return type as EmployeeTimestamp[&#x27;timestampType&#x27;];
    }
    // Default to CHECK_IN if unknown
    return &#x27;CHECK_IN&#x27;;
  }

  /**
   * Transform EmployeeTimestampUpdate to backend format
   * Backend expects snake_case: timestamp_type, location_name, photo_timestamp
   */
  private transformUpdateToBackend(data: EmployeeTimestampUpdate): any {
    // Map frontend timestampType to backend format if provided
    const backendTimestampType &#x3D; data.timestampType
      ? this.mapTimestampTypeToBackend(data.timestampType)
      : undefined;

    return {
      timestamp_type: backendTimestampType,  // snake_case for backend
      latitude: data.latitude,
      longitude: data.longitude,
      location_name: data.locationName,  // snake_case for backend
      photo_timestamp: data.photoTimestamp  // snake_case for backend
    };
  }

  /**
   * Transform backend response to EmployeeTimestamp
   */
  private transformBackendToEmployeeTimestamp(backend: any): EmployeeTimestamp {
    return {
      timestampId: backend.timestampId || backend.timestamp_id || &#x27;&#x27;,
      companyEmployeeId: backend.company_employeeId || backend.companyEmployeeId || &#x27;&#x27;,
      companyId: backend.companyId || backend.company_id || &#x27;&#x27;,
      timestampType: this.mapBackendToTimestampType(backend.timestampType || backend.timestamp_type || &#x27;CHECK_IN&#x27;),
      timestamp: backend.timestamp || new Date().toISOString(),
      locationName: backend.locationName || backend.location_name,
      latitude: backend.latitude,
      longitude: backend.longitude,
      photoTimestamp: backend.photoTimestamp || backend.photo_timestamp,
      status: backend.status || &#x27;pending&#x27;,
      approvedBy: backend.approvedBy || backend.approved_by,
      approvedAt: backend.approvedAt || backend.approved_at,
      rejectionReason: backend.rejectionReason || backend.rejection_reason,
      createdAt: backend.createdAt || backend.created_at || new Date().toISOString(),
      updatedAt: backend.updatedAt || backend.updated_at,
      employee: backend.employee ? {
        member: backend.employee.member || {},
        position: backend.employee.position,
        department: backend.employee.department,
        companyEmployeeId: backend.employee.company_employeeId || backend.employee.companyEmployeeId || &#x27;&#x27;,
        employeeId: backend.employee.employeeId || backend.employee.employee_id || &#x27;&#x27;,
        bossId: backend.employee.bossId || backend.employee.boss_id || &#x27;&#x27;
      } : undefined
    };
  }

  /**
   * Initialize default locations
   */
  private initializeDefaultLocations(): void {
    const defaultLocations: LocationSettings[] &#x3D; [
      {
        id: &#x27;main-office&#x27;,
        name: &#x27;สำนักงานใหญ่&#x27;,
        address: &#x27;123 ถนนสุขุมวิท กรุงเทพมหานคร 10110&#x27;,
        coordinates: { latitude: 13.7563, longitude: 100.5018 },
        radius: 100,
        isActive: true,
        allowedTypes: [&#x27;checkin&#x27;, &#x27;checkout&#x27;, &#x27;break_start&#x27;, &#x27;break_end&#x27;],
        workingHours: {
          start: &#x27;08:00&#x27;,
          end: &#x27;17:00&#x27;,
          days: [1, 2, 3, 4, 5] // Monday to Friday
        },
        timezone: &#x27;Asia/Bangkok&#x27;
      },
      {
        id: &#x27;branch-office&#x27;,
        name: &#x27;สาขาเชียงใหม่&#x27;,
        address: &#x27;456 ถนนนิมมานเหมินท์ เชียงใหม่ 50200&#x27;,
        coordinates: { latitude: 18.7883, longitude: 98.9853 },
        radius: 50,
        isActive: true,
        allowedTypes: [&#x27;checkin&#x27;, &#x27;checkout&#x27;],
        workingHours: {
          start: &#x27;08:30&#x27;,
          end: &#x27;17:30&#x27;,
          days: [1, 2, 3, 4, 5]
        },
        timezone: &#x27;Asia/Bangkok&#x27;
      }
    ];

    defaultLocations.forEach(location &#x3D;&gt; {
      this.locationsMap.set(location.id, location);
    });
    this._locations.set(Array.from(this.locationsMap.values()));
  }

  /**
   * Start location tracking
   */
  private startLocationTracking(): void {
    if (navigator.geolocation) {
      this.watchId &#x3D; navigator.geolocation.watchPosition(
        (position) &#x3D;&gt; {
          this.currentLocation &#x3D; position;
          this.checkGeofences(position);
        },
        (error) &#x3D;&gt; {
          console.error(&#x27;Location tracking error:&#x27;, error);
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 30000
        }
      );
    }
  }

  /**
   * Stop location tracking
   */
  public stopLocationTracking(): void {
    if (this.watchId !&#x3D;&#x3D; null) {
      navigator.geolocation.clearWatch(this.watchId);
      this.watchId &#x3D; null;
    }
    if (this.locationUpdateInterval) {
      clearInterval(this.locationUpdateInterval);
      this.locationUpdateInterval &#x3D; null;
    }
  }

  /**
   * Check geofences for current location
   */
  private checkGeofences(position: GeolocationPosition): void {
    const currentCoords &#x3D; {
      latitude: position.coords.latitude,
      longitude: position.coords.longitude
    };

    this.locationsMap.forEach((location, locationId) &#x3D;&gt; {
      if (!location.isActive) return;

      const distance &#x3D; this.calculateDistance(
        currentCoords,
        location.coordinates
      );

      const isInside &#x3D; distance &lt;&#x3D; location.radius;
      const lastEvent &#x3D; this.getLastGeofenceEvent(locationId, position.timestamp);

      if (isInside &amp;&amp; (!lastEvent || lastEvent.eventType &#x3D;&#x3D;&#x3D; &#x27;exit&#x27;)) {
        this.recordGeofenceEvent(locationId, &#x27;enter&#x27;, currentCoords, position.coords.accuracy);
      } else if (!isInside &amp;&amp; lastEvent &amp;&amp; lastEvent.eventType &#x3D;&#x3D;&#x3D; &#x27;enter&#x27;) {
        this.recordGeofenceEvent(locationId, &#x27;exit&#x27;, currentCoords, position.coords.accuracy);
      }
    });
  }

  /**
   * Record geofence event
   */
  private recordGeofenceEvent(
    locationId: string,
    eventType: &#x27;enter&#x27; | &#x27;exit&#x27;,
    coordinates: { latitude: number; longitude: number },
    accuracy: number
  ): void {
    const event: GeofenceEvent &#x3D; {
      id: this.generateId(),
      userId: &#x27;current-user&#x27;, // In real app, get from auth service
      locationId,
      eventType,
      timestamp: new Date(),
      coordinates,
      accuracy
    };

    this.geofenceEventsMap.set(event.id, event);
    this._geofenceEvents.set(Array.from(this.geofenceEventsMap.values()));
  }

  /**
   * Get last geofence event for location
   */
  private getLastGeofenceEvent(locationId: string, beforeTimestamp: number): GeofenceEvent | null {
    const events &#x3D; Array.from(this.geofenceEventsMap.values())
      .filter((event: GeofenceEvent) &#x3D;&gt; event.locationId &#x3D;&#x3D;&#x3D; locationId &amp;&amp; event.timestamp.getTime() &lt; beforeTimestamp)
      .sort((a: GeofenceEvent, b: GeofenceEvent) &#x3D;&gt; b.timestamp.getTime() - a.timestamp.getTime());

    return events.length &gt; 0 ? events[0] : null;
  }

  /**
   * Calculate distance between two coordinates
   */
  private calculateDistance(
    coord1: { latitude: number; longitude: number },
    coord2: { latitude: number; longitude: number }
  ): number {
    const R &#x3D; 6371e3; // Earth&#x27;s radius in meters
    const φ1 &#x3D; coord1.latitude * Math.PI / 180;
    const φ2 &#x3D; coord2.latitude * Math.PI / 180;
    const Δφ &#x3D; (coord2.latitude - coord1.latitude) * Math.PI / 180;
    const Δλ &#x3D; (coord2.longitude - coord1.longitude) * Math.PI / 180;

    const a &#x3D; Math.sin(Δφ/2) * Math.sin(Δφ/2) +
              Math.cos(φ1) * Math.cos(φ2) *
              Math.sin(Δλ/2) * Math.sin(Δλ/2);
    const c &#x3D; 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

    return R * c; // Distance in meters
  }

  /**
   * Create timestamp record (client-side only)
   * Note: This is different from createTimestamp() which calls the backend API
   */
  public async createTimestampRecord(
    type: TimestampRecord[&#x27;type&#x27;],
    locationId?: string,
    photo?: string,
    notes?: string
  ): Promise&lt;TimestampRecord&gt; {
    const currentLocation &#x3D; await this.getCurrentLocation();
    const location &#x3D; locationId ? this.locationsMap.get(locationId) : this.findNearestLocation(currentLocation);

    if (!location) {
      throw new Error(&#x27;No valid location found&#x27;);
    }

    // Check if location allows this type of timestamp
    if (!location.allowedTypes.includes(type)) {
      throw new Error(&#x60;Location does not allow ${type} timestamps&#x60;);
    }

    // Check working hours
    if (!this.isWithinWorkingHours(location, new Date())) {
      throw new Error(&#x27;Outside working hours&#x27;);
    }

    const timestamp: TimestampRecord &#x3D; {
      id: this.generateId(),
      userId: &#x27;current-user&#x27;, // In real app, get from auth service
      userName: &#x27;Current User&#x27;, // In real app, get from user service
      type,
      timestamp: new Date(),
      location: {
        latitude: currentLocation.latitude,
        longitude: currentLocation.longitude,
        address: location.address,
        accuracy: currentLocation.accuracy
      },
      photo: photo ? {
        data: photo,
        timestamp: new Date(),
        location: {
          latitude: currentLocation.latitude,
          longitude: currentLocation.longitude
        }
      } : undefined,
      deviceInfo: {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language
      },
      status: &#x27;pending&#x27;,
      notes,
      createdAt: new Date(),
      updatedAt: new Date()
    };

    this.timestampsMap.set(timestamp.id, timestamp);
    this._timestamps.set(Array.from(this.timestampsMap.values()));
    this.updateStats();

    return timestamp;
  }

  /**
   * Get current location
   */
  private async getCurrentLocation(): Promise&lt;{ latitude: number; longitude: number; accuracy: number }&gt; {
    return new Promise((resolve, reject) &#x3D;&gt; {
      if (this.currentLocation) {
        resolve({
          latitude: this.currentLocation.coords.latitude,
          longitude: this.currentLocation.coords.longitude,
          accuracy: this.currentLocation.coords.accuracy
        });
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) &#x3D;&gt; {
          resolve({
            latitude: position.coords.latitude,
            longitude: position.coords.longitude,
            accuracy: position.coords.accuracy
          });
        },
        (error) &#x3D;&gt; {
          reject(error);
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 30000
        }
      );
    });
  }

  /**
   * Find nearest location
   */
  private findNearestLocation(currentLocation: { latitude: number; longitude: number }): LocationSettings | null {
    let nearestLocation: LocationSettings | null &#x3D; null;
    let minDistance &#x3D; Infinity;

    this.locationsMap.forEach(location &#x3D;&gt; {
      if (!location.isActive) return;

      const distance &#x3D; this.calculateDistance(currentLocation, location.coordinates);
      if (distance &lt; minDistance &amp;&amp; distance &lt;&#x3D; location.radius) {
        minDistance &#x3D; distance;
        nearestLocation &#x3D; location;
      }
    });

    return nearestLocation;
  }

  /**
   * Check if timestamp is within working hours
   */
  private isWithinWorkingHours(location: LocationSettings, timestamp: Date): boolean {
    const now &#x3D; new Date(timestamp);
    const dayOfWeek &#x3D; now.getDay();
    const timeString &#x3D; now.toTimeString().slice(0, 5); // HH:mm format

    return location.workingHours.days.includes(dayOfWeek) &amp;&amp;
           timeString &gt;&#x3D; location.workingHours.start &amp;&amp;
           timeString &lt;&#x3D; location.workingHours.end;
  }

  /**
   * Update timestamp status
   */
  public updateTimestampStatus(id: string, status: TimestampRecord[&#x27;status&#x27;], notes?: string): void {
    const timestamp &#x3D; this.timestampsMap.get(id);
    if (timestamp) {
      timestamp.status &#x3D; status;
      timestamp.notes &#x3D; notes || timestamp.notes;
      timestamp.updatedAt &#x3D; new Date();

      this.timestampsMap.set(id, timestamp);
      this._timestamps.set(Array.from(this.timestampsMap.values()));
      this.updateStats();
    }
  }

  /**
   * Get timestamps by date range
   */
  public getTimestampsByDateRange(startDate: Date, endDate: Date): TimestampRecord[] {
    return Array.from(this.timestampsMap.values())
      .filter(timestamp &#x3D;&gt;
        timestamp.timestamp &gt;&#x3D; startDate &amp;&amp; timestamp.timestamp &lt;&#x3D; endDate
      )
      .sort((a, b) &#x3D;&gt; b.timestamp.getTime() - a.timestamp.getTime());
  }

  /**
   * Get timestamps by user
   */
  public getTimestampsByUser(userId: string): TimestampRecord[] {
    return Array.from(this.timestampsMap.values())
      .filter(timestamp &#x3D;&gt; timestamp.userId &#x3D;&#x3D;&#x3D; userId)
      .sort((a, b) &#x3D;&gt; b.timestamp.getTime() - a.timestamp.getTime());
  }

  /**
   * Get pending timestamps
   */
  public getPendingTimestamps(): TimestampRecord[] {
    return Array.from(this.timestampsMap.values())
      .filter(timestamp &#x3D;&gt; timestamp.status &#x3D;&#x3D;&#x3D; &#x27;pending&#x27;)
      .sort((a, b) &#x3D;&gt; a.timestamp.getTime() - b.timestamp.getTime());
  }

  /**
   * Add location
   */
  public addLocation(location: Omit&lt;LocationSettings, &#x27;id&#x27;&gt;): string {
    const id &#x3D; this.generateId();
    const newLocation: LocationSettings &#x3D; { ...location, id };

    this.locationsMap.set(id, newLocation);
    this._locations.set(Array.from(this.locationsMap.values()));

    return id;
  }

  /**
   * Update location
   */
  public updateLocation(id: string, updates: Partial&lt;LocationSettings&gt;): void {
    const location &#x3D; this.locationsMap.get(id);
    if (location) {
      const updatedLocation &#x3D; { ...location, ...updates };
      this.locationsMap.set(id, updatedLocation);
      this._locations.set(Array.from(this.locationsMap.values()));
    }
  }

  /**
   * Delete location
   */
  public deleteLocation(id: string): void {
    this.locationsMap.delete(id);
    this._locations.set(Array.from(this.locationsMap.values()));
  }

  /**
   * Update statistics
   */
  private updateStats(): void {
    const stats &#x3D; this.calculateStats();
    this._stats.set(stats);
  }

  /**
   * Calculate statistics
   */
  private calculateStats(): TimestampStats {
    const now &#x3D; new Date();
    const today &#x3D; new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const weekStart &#x3D; new Date(today);
    weekStart.setDate(today.getDate() - today.getDay());
    const monthStart &#x3D; new Date(now.getFullYear(), now.getMonth(), 1);

    const allTimestamps &#x3D; Array.from(this.timestampsMap.values());
    const todayTimestamps &#x3D; allTimestamps.filter(t &#x3D;&gt; t.timestamp &gt;&#x3D; today);
    const weekTimestamps &#x3D; allTimestamps.filter(t &#x3D;&gt; t.timestamp &gt;&#x3D; weekStart);
    const monthTimestamps &#x3D; allTimestamps.filter(t &#x3D;&gt; t.timestamp &gt;&#x3D; monthStart);

    const checkins &#x3D; allTimestamps.filter(t &#x3D;&gt; t.type &#x3D;&#x3D;&#x3D; &#x27;checkin&#x27;);
    const checkouts &#x3D; allTimestamps.filter(t &#x3D;&gt; t.type &#x3D;&#x3D;&#x3D; &#x27;checkout&#x27;);

    return {
      totalRecords: allTimestamps.length,
      todayRecords: todayTimestamps.length,
      thisWeekRecords: weekTimestamps.length,
      thisMonthRecords: monthTimestamps.length,
      pendingApprovals: allTimestamps.filter(t &#x3D;&gt; t.status &#x3D;&#x3D;&#x3D; &#x27;pending&#x27;).length,
      averageCheckinTime: this.calculateAverageTime(checkins),
      averageCheckoutTime: this.calculateAverageTime(checkouts),
      lateCheckins: this.countLateCheckins(checkins),
      earlyCheckouts: this.countEarlyCheckouts(checkouts)
    };
  }

  /**
   * Calculate average time for timestamps
   */
  private calculateAverageTime(timestamps: TimestampRecord[]): string {
    if (timestamps.length &#x3D;&#x3D;&#x3D; 0) return &#x27;--:--&#x27;;

    const totalMinutes &#x3D; timestamps.reduce((sum, t) &#x3D;&gt; {
      const time &#x3D; new Date(t.timestamp);
      return sum + time.getHours() * 60 + time.getMinutes();
    }, 0);

    const averageMinutes &#x3D; Math.round(totalMinutes / timestamps.length);
    const hours &#x3D; Math.floor(averageMinutes / 60);
    const minutes &#x3D; averageMinutes % 60;

    return &#x60;${hours.toString().padStart(2, &#x27;0&#x27;)}:${minutes.toString().padStart(2, &#x27;0&#x27;)}&#x60;;
  }

  /**
   * Count late check-ins
   */
  private countLateCheckins(checkins: TimestampRecord[]): number {
    const lateThreshold &#x3D; 8 * 60; // 8:00 AM in minutes
    return checkins.filter(t &#x3D;&gt; {
      const time &#x3D; new Date(t.timestamp);
      const minutes &#x3D; time.getHours() * 60 + time.getMinutes();
      return minutes &gt; lateThreshold;
    }).length;
  }

  /**
   * Count early check-outs
   */
  private countEarlyCheckouts(checkouts: TimestampRecord[]): number {
    const earlyThreshold &#x3D; 17 * 60; // 5:00 PM in minutes
    return checkouts.filter(t &#x3D;&gt; {
      const time &#x3D; new Date(t.timestamp);
      const minutes &#x3D; time.getHours() * 60 + time.getMinutes();
      return minutes &lt; earlyThreshold;
    }).length;
  }

  /**
   * Get initial stats
   */
  private getInitialStats(): TimestampStats {
    return {
      totalRecords: 0,
      todayRecords: 0,
      thisWeekRecords: 0,
      thisMonthRecords: 0,
      pendingApprovals: 0,
      averageCheckinTime: &#x27;--:--&#x27;,
      averageCheckoutTime: &#x27;--:--&#x27;,
      lateCheckins: 0,
      earlyCheckouts: 0
    };
  }

  /**
   * Load stored data from localStorage
   */
  private loadStoredData(): void {
    try {
      const storedTimestamps &#x3D; localStorage.getItem(&#x27;timestamp-records&#x27;);
      if (storedTimestamps) {
        const timestamps &#x3D; JSON.parse(storedTimestamps);
        timestamps.forEach((t: any) &#x3D;&gt; {
          t.timestamp &#x3D; new Date(t.timestamp);
          t.createdAt &#x3D; new Date(t.createdAt);
          t.updatedAt &#x3D; new Date(t.updatedAt);
          if (t.photo) {
            t.photo.timestamp &#x3D; new Date(t.photo.timestamp);
          }
          this.timestampsMap.set(t.id, t);
        });
        this._timestamps.set(Array.from(this.timestampsMap.values()));
      }

      const storedLocations &#x3D; localStorage.getItem(&#x27;timestamp-locations&#x27;);
      if (storedLocations) {
        const locations &#x3D; JSON.parse(storedLocations);
        locations.forEach((l: any) &#x3D;&gt; {
          this.locationsMap.set(l.id, l);
        });
        this._locations.set(Array.from(this.locationsMap.values()));
      }
    } catch (error) {
      console.error(&#x27;Failed to load stored data:&#x27;, error);
    }
  }

  /**
   * Save data to localStorage
   */
  public saveData(): void {
    try {
      localStorage.setItem(&#x27;timestamp-records&#x27;, JSON.stringify(Array.from(this.timestampsMap.values())));
      localStorage.setItem(&#x27;timestamp-locations&#x27;, JSON.stringify(Array.from(this.locationsMap.values())));
    } catch (error) {
      console.error(&#x27;Failed to save data:&#x27;, error);
    }
  }

  /**
   * Export data
   */
  public exportData(): string {
    const data &#x3D; {
      timestamps: Array.from(this.timestampsMap.values()),
      locations: Array.from(this.locationsMap.values()),
      geofenceEvents: Array.from(this.geofenceEventsMap.values()),
      exportDate: new Date().toISOString()
    };
    return JSON.stringify(data, null, 2);
  }

  /**
   * Import data
   */
  public importData(data: string): void {
    try {
      const imported &#x3D; JSON.parse(data);

      if (imported.timestamps) {
        imported.timestamps.forEach((t: any) &#x3D;&gt; {
          t.timestamp &#x3D; new Date(t.timestamp);
          t.createdAt &#x3D; new Date(t.createdAt);
          t.updatedAt &#x3D; new Date(t.updatedAt);
          if (t.photo) {
            t.photo.timestamp &#x3D; new Date(t.photo.timestamp);
          }
          this.timestampsMap.set(t.id, t);
        });
        this._timestamps.set(Array.from(this.timestampsMap.values()));
      }

      if (imported.locations) {
        imported.locations.forEach((l: any) &#x3D;&gt; {
          this.locationsMap.set(l.id, l);
        });
        this._locations.set(Array.from(this.locationsMap.values()));
      }

      this.updateStats();
    } catch (error) {
      console.error(&#x27;Failed to import data:&#x27;, error);
      throw error;
    }
  }

  /**
   * Generate unique ID
   */
  private generateId(): string {
    return &#x27;ts_&#x27; + Date.now() + &#x27;_&#x27; + Math.random().toString(36).substr(2, 9);
  }
}

</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'TimestampStats-1.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
