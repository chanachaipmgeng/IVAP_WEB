<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>frontend documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">frontend documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">

















<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  GroupRecognitionResult</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/shared/components/group-face-recognition/group-face-recognition.component.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Group recognition result interface</p>

            </p>


        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#age" 
>
                                            age
                                        </a>
                                </li>
                                <li>
                                        <a href="#confidence" 
>
                                            confidence
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#expressions" 
>
                                            expressions
                                        </a>
                                </li>
                                <li>
                                        <a href="#firstName" 
>
                                            firstName
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#gender" 
>
                                            gender
                                        </a>
                                </li>
                                <li>
                                        <a href="#lastName" 
>
                                            lastName
                                        </a>
                                </li>
                                <li>
                                        <a href="#location" 
>
                                            location
                                        </a>
                                </li>
                                <li>
                                        <a href="#memberId" 
>
                                            memberId
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#snapshot" 
>
                                            snapshot
                                        </a>
                                </li>
                                <li>
                                        <a href="#timestamp" 
>
                                            timestamp
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="age"></a>
                                        <span class="name "><b>age</b>
                                            <a href="#age">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>age:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="confidence"></a>
                                        <span class="name "><b>confidence</b>
                                            <a href="#confidence">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>confidence:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="expressions"></a>
                                        <span class="name "><b>expressions</b>
                                            <a href="#expressions">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>expressions:     <code>Record&lt;string | unknown&gt;</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>Record&lt;string | unknown&gt;</code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="firstName"></a>
                                        <span class="name "><b>firstName</b>
                                            <a href="#firstName">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>firstName:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="gender"></a>
                                        <span class="name "><b>gender</b>
                                            <a href="#gender">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>gender:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lastName"></a>
                                        <span class="name "><b>lastName</b>
                                            <a href="#lastName">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lastName:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="location"></a>
                                        <span class="name "><b>location</b>
                                            <a href="#location">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>location:     <code>literal type</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>literal type</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="memberId"></a>
                                        <span class="name "><b>memberId</b>
                                            <a href="#memberId">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>memberId:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="snapshot"></a>
                                        <span class="name "><b>snapshot</b>
                                            <a href="#snapshot">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>snapshot:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="timestamp"></a>
                                        <span class="name "><b>timestamp</b>
                                            <a href="#timestamp">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>timestamp:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit, ViewChild, ElementRef, Input, Output, EventEmitter, effect } from &#x27;@angular/core&#x27;;
import { CommonModule, NgOptimizedImage } from &#x27;@angular/common&#x27;;
import { FormsModule } from &#x27;@angular/forms&#x27;;
import { FaceDetectionService, FaceDetectionResult, FaceRecognitionResult } from &#x27;../../../core/services/face-detection.service&#x27;;
import { GlassButtonComponent } from &#x27;../glass-button/glass-button.component&#x27;;
import { GlassCardComponent } from &#x27;../glass-card/glass-card.component&#x27;;
import { assessImageQuality, ImageQualityAssessment, isImageQualitySufficientForGroup } from &#x27;../../../core/utils/image-quality.utils&#x27;;
import { I18nService } from &#x27;../../../core/services/i18n.service&#x27;;
import { BaseComponent } from &#x27;../../../core/base/base.component&#x27;;

import { ImageOptimizationDirective } from &#x27;../../directives/image-optimization.directive&#x27;;

/**
 * Group recognition result interface
 */
export interface GroupRecognitionResult {
  memberId: string;
  firstName: string;
  lastName: string;
  confidence: number;
  location: { top: number; right: number; bottom: number; left: number };
  timestamp: Date;
  snapshot?: string;
  age?: number;
  gender?: string;
  expressions?: Record&lt;string, unknown&gt;;
}

@Component({
  selector: &#x27;app-group-face-recognition&#x27;,
  standalone: true,
  imports: [
    CommonModule,
    NgOptimizedImage,
    FormsModule,
    GlassButtonComponent,
    GlassCardComponent,
    ImageOptimizationDirective
  ],
  templateUrl: &#x27;./group-face-recognition.component.html&#x27;,
  styleUrls: [&#x27;./group-face-recognition.component.scss&#x27;]
})
export class GroupFaceRecognitionComponent extends BaseComponent implements OnInit {
  /**
   * Video element reference
   */
  @ViewChild(&#x27;videoElement&#x27;, { static: false }) videoElement!: ElementRef&lt;HTMLVideoElement&gt;;

  /**
   * Canvas element reference
   */
  @ViewChild(&#x27;canvasElement&#x27;, { static: false }) canvasElement!: ElementRef&lt;HTMLCanvasElement&gt;;

  /**
   * Auto detect faces
   */
  @Input() autoDetect: boolean &#x3D; true;

  /**
   * Detection interval in milliseconds
   */
  @Input() detectionInterval: number &#x3D; 1000;

  /**
   * Enable quality check
   */
  @Input() enableQualityCheck: boolean &#x3D; true;

  /**
   * Show face landmarks
   */
  @Input() showLandmarks: boolean &#x3D; true;

  /**
   * Maximum number of faces
   */
  @Input() maxFaces: number &#x3D; 10;

  /**
   * Minimum confidence threshold
   */
  @Input() minConfidence: number &#x3D; 0.6;

  /**
   * Custom CSS classes
   */
  @Input() customClass?: string;

  /**
   * ARIA label for the component
   */
  @Input() ariaLabel?: string;

  /**
   * Faces recognized event
   */
  @Output() facesRecognized &#x3D; new EventEmitter&lt;GroupRecognitionResult[]&gt;();

  /**
   * Quality changed event
   */
  @Output() qualityChanged &#x3D; new EventEmitter&lt;ImageQualityAssessment&gt;();

  /**
   * Initialization state
   */
  isInitialized &#x3D; false;

  /**
   * Streaming state
   */
  isStreaming &#x3D; false;

  /**
   * Detecting state
   */
  isDetecting &#x3D; false;

  /**
   * Current face detections
   */
  currentDetections: FaceDetectionResult[] &#x3D; [];

  /**
   * Current face recognitions
   */
  currentRecognitions: GroupRecognitionResult[] &#x3D; [];

  /**
   * Recognized faces
   */
  recognizedFaces: GroupRecognitionResult[] &#x3D; [];

  /**
   * Image quality assessment
   */
  imageQuality: ImageQualityAssessment | null &#x3D; null;

  /**
   * Show quality feedback
   */
  showQualityFeedback &#x3D; false;

  /**
   * Quality feedback message
   */
  qualityFeedbackMessage &#x3D; &#x27;&#x27;;

  /**
   * Quality recommendations
   */
  qualityRecommendations: string[] &#x3D; [];

  /**
   * Detection timer
   */
  private detectionTimer: ReturnType&lt;typeof setInterval&gt; | null &#x3D; null;

  /**
   * Last save timestamp
   */
  private lastSaveAt &#x3D; 0;

  /**
   * Saving state
   */
  private isSaving &#x3D; false;

  constructor(
    private faceDetectionService: FaceDetectionService,
    public i18n: I18nService
  ) {
    super();
  }

  /**
   * Initialize component
   */
  ngOnInit(): void {
    this.initializeService();
    this.subscribeToService();
  }

  /**
   * Translate key
   */
  t(key: string): string {
    return this.i18n.translate(key);
  }

  /**
   * Cleanup on destroy
   */
  override ngOnDestroy(): void {
    this.stopDetection();
    this.stopCamera();
    super.ngOnDestroy();
  }

  /**
   * Initialize face detection service
   */
  private async initializeService(): Promise&lt;void&gt; {
    try {
      // Wait for models to load
      while (!this.faceDetectionService.isReady()) {
        await new Promise(resolve &#x3D;&gt; setTimeout(resolve, 100));
      }
      this.isInitialized &#x3D; true;
    } catch (error) {
      console.error(&#x27;Failed to initialize face detection service:&#x27;, error);
    }
  }

  /**
   * Subscribe to service observables
   */
  private subscribeToService(): void {
    // ✅ Using signals (no subscription needed)
    effect(() &#x3D;&gt; {
      const detections &#x3D; this.faceDetectionService.detections();
      this.currentDetections &#x3D; detections;
      this.updateRecognitions();
    });

    effect(() &#x3D;&gt; {
      const recognitions &#x3D; this.faceDetectionService.recognitions();
      this.updateGroupRecognitions(recognitions);
    });
  }

  /**
   * Start camera stream
   */
  async startCamera(): Promise&lt;void&gt; {
    try {
      const stream &#x3D; await navigator.mediaDevices.getUserMedia({
        video: {
          width: { ideal: 640 },
          height: { ideal: 480 },
          facingMode: &#x27;user&#x27;
        }
      });

      if (this.videoElement) {
        this.videoElement.nativeElement.srcObject &#x3D; stream;
        this.videoElement.nativeElement.play();
        this.isStreaming &#x3D; true;

        if (this.autoDetect) {
          this.startDetection();
        }
      }
    } catch (error) {
      console.error(&#x27;Failed to start camera:&#x27;, error);
      alert(&#x27;ไม่สามารถเข้าถึงกล้องได้ กรุณาอนุญาตการใช้งานกล้อง&#x27;);
    }
  }

  /**
   * Stop camera stream
   */
  stopCamera(): void {
    if (this.videoElement &amp;&amp; this.videoElement.nativeElement.srcObject) {
      const stream &#x3D; this.videoElement.nativeElement.srcObject as MediaStream;
      stream.getTracks().forEach(track &#x3D;&gt; track.stop());
      this.videoElement.nativeElement.srcObject &#x3D; null;
    }
    this.isStreaming &#x3D; false;
    this.stopDetection();
  }

  /**
   * Start automatic face detection
   */
  startDetection(): void {
    if (this.detectionTimer) {
      clearInterval(this.detectionTimer);
    }

    this.detectionTimer &#x3D; setInterval(async () &#x3D;&gt; {
      if (this.isStreaming &amp;&amp; this.videoElement) {
        await this.detectFaces();
      }
    }, this.detectionInterval);
  }

  /**
   * Stop automatic face detection
   */
  stopDetection(): void {
    if (this.detectionTimer) {
      clearInterval(this.detectionTimer);
      this.detectionTimer &#x3D; null;
    }
  }

  /**
   * Detect faces in current frame
   */
  async detectFaces(): Promise&lt;void&gt; {
    if (!this.isInitialized || this.isDetecting) return;

    try {
      this.isDetecting &#x3D; true;
      const element &#x3D; this.videoElement?.nativeElement;

      if (!element) return;

      // Assess image quality first
      if (this.enableQualityCheck) {
        this.assessCurrentImageQuality(element);
      }

      const detections &#x3D; await this.faceDetectionService.detectFaces(element);

      if (detections.length &gt; 0) {
        // Capture snapshots
        this.captureFaceSnapshots(detections, element);

        await this.faceDetectionService.recognizeFaces(detections);
      }

      // Draw detections on canvas
      this.drawDetections(detections);

      // Auto-save recognized faces every 10 seconds
      const now &#x3D; Date.now();
      if (!this.isSaving &amp;&amp; this.recognizedFaces.length &gt; 0 &amp;&amp; (now - this.lastSaveAt) &gt; 10000) {
        this.isSaving &#x3D; true;
        await this.saveRecognizedFaces();
        this.lastSaveAt &#x3D; Date.now();
        this.isSaving &#x3D; false;
      }
    } catch (error) {
      console.error(&#x27;Face detection failed:&#x27;, error);
    } finally {
      this.isDetecting &#x3D; false;
    }
  }

  /**
   * Capture face snapshots from video/canvas
   */
  private captureFaceSnapshots(detections: FaceDetectionResult[], element: HTMLVideoElement | HTMLCanvasElement): void {
    try {
      const canvas &#x3D; document.createElement(&#x27;canvas&#x27;);
      const ctx &#x3D; canvas.getContext(&#x27;2d&#x27;);
      if (!ctx) return;

      // Draw the current frame to an off-screen canvas to extract crops
      // Use original element dimensions
      const width &#x3D; element instanceof HTMLVideoElement ? element.videoWidth : element.width;
      const height &#x3D; element instanceof HTMLVideoElement ? element.videoHeight : element.height;

      canvas.width &#x3D; width;
      canvas.height &#x3D; height;
      ctx.drawImage(element, 0, 0, width, height);

      detections.forEach(detection &#x3D;&gt; {
        const { x, y, width: boxWidth, height: boxHeight } &#x3D; detection.boundingBox;

        // Add some padding to the crop
        const padding &#x3D; 20;
        const cropX &#x3D; Math.max(0, x - padding);
        const cropY &#x3D; Math.max(0, y - padding);
        const cropWidth &#x3D; Math.min(width - cropX, boxWidth + (padding * 2));
        const cropHeight &#x3D; Math.min(height - cropY, boxHeight + (padding * 2));

        if (cropWidth &gt; 0 &amp;&amp; cropHeight &gt; 0) {
          const faceCanvas &#x3D; document.createElement(&#x27;canvas&#x27;);
          faceCanvas.width &#x3D; cropWidth;
          faceCanvas.height &#x3D; cropHeight;
          const faceCtx &#x3D; faceCanvas.getContext(&#x27;2d&#x27;);

          if (faceCtx) {
            faceCtx.drawImage(canvas, cropX, cropY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);
            detection.snapshot &#x3D; faceCanvas.toDataURL(&#x27;image/jpeg&#x27;, 0.8);
          }
        }
      });
    } catch (error) {
      console.error(&#x27;Failed to capture face snapshot:&#x27;, error);
    }
  }

  /**
   * Update group recognitions from service results
   */
  private updateGroupRecognitions(recognitions: FaceRecognitionResult[]): void {
    this.currentRecognitions &#x3D; recognitions.map((recognition, index) &#x3D;&gt; {
      const detection &#x3D; this.currentDetections[index];
      return {
        memberId: recognition.id || &#x60;face_${index}&#x60;,
        firstName: recognition.name?.split(&#x27; &#x27;)[0] || &#x27;Unknown&#x27;,
        lastName: recognition.name?.split(&#x27; &#x27;).slice(1).join(&#x27; &#x27;) || &#x27;&#x27;,
        confidence: recognition.confidence,
        location: {
          top: detection.boundingBox.y,
          right: detection.boundingBox.x + detection.boundingBox.width,
          bottom: detection.boundingBox.y + detection.boundingBox.height,
          left: detection.boundingBox.x
        },
        timestamp: new Date(),
        snapshot: detection.snapshot,
        age: detection.age,
        gender: detection.gender,
        expressions: detection.expressions
      };
    });

    // Update recognized faces list - Filter by minConfidence
    this.recognizedFaces &#x3D; this.currentRecognitions.filter(r &#x3D;&gt; r.confidence &gt;&#x3D; this.minConfidence);
    this.facesRecognized.emit(this.recognizedFaces);
  }

  /**
   * Update recognitions based on current detections
   */
  private updateRecognitions(): void {
    // This will be called when detections change
    // The actual recognition will be handled by the service
  }

  /**
   * Draw face detections on canvas
   */
  private drawDetections(detections: FaceDetectionResult[]): void {
    const canvas &#x3D; this.canvasElement?.nativeElement;
    const video &#x3D; this.videoElement?.nativeElement;

    if (!canvas || !video) return;

    const ctx &#x3D; canvas.getContext(&#x27;2d&#x27;);
    if (!ctx) return;

    // Set canvas size to match video
    canvas.width &#x3D; video.videoWidth;
    canvas.height &#x3D; video.videoHeight;

    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw video frame
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Draw face detections
    detections.forEach((detection, index) &#x3D;&gt; {
      const { x, y, width, height } &#x3D; detection.boundingBox;
      const recognition &#x3D; this.currentRecognitions[index];

      // Draw bounding box
      ctx.strokeStyle &#x3D; recognition?.confidence &gt; 0.7 ? &#x27;#10B981&#x27; : &#x27;#EF4444&#x27;;
      ctx.lineWidth &#x3D; 2;
      ctx.strokeRect(x, y, width, height);

      // Draw landmarks if enabled
      if (this.showLandmarks &amp;&amp; detection.landmarks) {
        this.drawLandmarks(ctx, detection.landmarks);
      }

      // Draw confidence score
      ctx.fillStyle &#x3D; recognition?.confidence &gt; 0.7 ? &#x27;#10B981&#x27; : &#x27;#EF4444&#x27;;
      ctx.font &#x3D; &#x27;14px Arial&#x27;;
      ctx.fillText(
        &#x60;${Math.round(detection.confidence * 100)}%&#x60;,
        x,
        y - 5
      );

      // Draw recognition info
      if (recognition) {
        ctx.fillText(
          &#x60;${recognition.firstName} ${recognition.lastName} (${Math.round(recognition.confidence * 100)}%)&#x60;,
          x,
          y + height + 20
        );
      }
    });
  }

  /**
   * Draw face landmarks on canvas
   */
  private drawLandmarks(ctx: CanvasRenderingContext2D, landmarks: any): void {
    if (!landmarks) return;

    // face-api.js landmarks structure: landmarks.positions is an array of {x, y}
    const positions &#x3D; landmarks.positions || landmarks._positions || [];
    if (!positions || positions.length &#x3D;&#x3D;&#x3D; 0) return;

    // Draw all landmark points
    ctx.fillStyle &#x3D; &#x27;#3B82F6&#x27;; // Blue color for landmarks
    ctx.strokeStyle &#x3D; &#x27;#60A5FA&#x27;;
    ctx.lineWidth &#x3D; 1;

    positions.forEach((point: { x: number; y: number }) &#x3D;&gt; {
      // Draw point
      ctx.beginPath();
      ctx.arc(point.x, point.y, 2, 0, 2 * Math.PI);
      ctx.fill();
    });

    // Draw connections for face outline (jaw line)
    if (positions.length &gt;&#x3D; 17) {
      ctx.strokeStyle &#x3D; &#x27;#60A5FA&#x27;;
      ctx.lineWidth &#x3D; 1.5;
      ctx.beginPath();
      for (let i &#x3D; 0; i &lt; 17; i++) {
        const point &#x3D; positions[i];
        if (i &#x3D;&#x3D;&#x3D; 0) {
          ctx.moveTo(point.x, point.y);
        } else {
          ctx.lineTo(point.x, point.y);
        }
      }
      ctx.stroke();
    }

    // Draw right eyebrow (points 17-21)
    if (positions.length &gt;&#x3D; 22) {
      ctx.strokeStyle &#x3D; &#x27;#60A5FA&#x27;;
      ctx.lineWidth &#x3D; 1.5;
      ctx.beginPath();
      for (let i &#x3D; 17; i &lt;&#x3D; 21; i++) {
        const point &#x3D; positions[i];
        if (i &#x3D;&#x3D;&#x3D; 17) {
          ctx.moveTo(point.x, point.y);
        } else {
          ctx.lineTo(point.x, point.y);
        }
      }
      ctx.stroke();
    }

    // Draw left eyebrow (points 22-26)
    if (positions.length &gt;&#x3D; 27) {
      ctx.strokeStyle &#x3D; &#x27;#60A5FA&#x27;;
      ctx.lineWidth &#x3D; 1.5;
      ctx.beginPath();
      for (let i &#x3D; 22; i &lt;&#x3D; 26; i++) {
        const point &#x3D; positions[i];
        if (i &#x3D;&#x3D;&#x3D; 22) {
          ctx.moveTo(point.x, point.y);
        } else {
          ctx.lineTo(point.x, point.y);
        }
      }
      ctx.stroke();
    }

    // Draw nose (points 27-35)
    if (positions.length &gt;&#x3D; 36) {
      ctx.strokeStyle &#x3D; &#x27;#60A5FA&#x27;;
      ctx.lineWidth &#x3D; 1.5;
      ctx.beginPath();
      for (let i &#x3D; 27; i &lt;&#x3D; 35; i++) {
        const point &#x3D; positions[i];
        if (i &#x3D;&#x3D;&#x3D; 27) {
          ctx.moveTo(point.x, point.y);
        } else {
          ctx.lineTo(point.x, point.y);
        }
      }
      ctx.stroke();
    }

    // Draw right eye (points 36-41)
    if (positions.length &gt;&#x3D; 42) {
      ctx.strokeStyle &#x3D; &#x27;#10B981&#x27;; // Green for eyes
      ctx.lineWidth &#x3D; 1.5;
      ctx.beginPath();
      for (let i &#x3D; 36; i &lt;&#x3D; 41; i++) {
        const point &#x3D; positions[i];
        if (i &#x3D;&#x3D;&#x3D; 36) {
          ctx.moveTo(point.x, point.y);
        } else {
          ctx.lineTo(point.x, point.y);
        }
      }
      ctx.closePath();
      ctx.stroke();
    }

    // Draw left eye (points 42-47)
    if (positions.length &gt;&#x3D; 48) {
      ctx.strokeStyle &#x3D; &#x27;#10B981&#x27;; // Green for eyes
      ctx.lineWidth &#x3D; 1.5;
      ctx.beginPath();
      for (let i &#x3D; 42; i &lt;&#x3D; 47; i++) {
        const point &#x3D; positions[i];
        if (i &#x3D;&#x3D;&#x3D; 42) {
          ctx.moveTo(point.x, point.y);
        } else {
          ctx.lineTo(point.x, point.y);
        }
      }
      ctx.closePath();
      ctx.stroke();
    }

    // Draw mouth outer (points 48-59)
    if (positions.length &gt;&#x3D; 60) {
      ctx.strokeStyle &#x3D; &#x27;#F59E0B&#x27;; // Orange for mouth
      ctx.lineWidth &#x3D; 1.5;
      ctx.beginPath();
      for (let i &#x3D; 48; i &lt;&#x3D; 59; i++) {
        const point &#x3D; positions[i];
        if (i &#x3D;&#x3D;&#x3D; 48) {
          ctx.moveTo(point.x, point.y);
        } else {
          ctx.lineTo(point.x, point.y);
        }
      }
      ctx.closePath();
      ctx.stroke();
    }

    // Draw mouth inner (points 60-67)
    if (positions.length &gt;&#x3D; 68) {
      ctx.strokeStyle &#x3D; &#x27;#F59E0B&#x27;; // Orange for mouth
      ctx.lineWidth &#x3D; 1.5;
      ctx.beginPath();
      for (let i &#x3D; 60; i &lt;&#x3D; 67; i++) {
        const point &#x3D; positions[i];
        if (i &#x3D;&#x3D;&#x3D; 60) {
          ctx.moveTo(point.x, point.y);
        } else {
          ctx.lineTo(point.x, point.y);
        }
      }
      ctx.closePath();
      ctx.stroke();
    }
  }

  /**
   * Assess image quality of current frame
   */
  private assessCurrentImageQuality(element: HTMLVideoElement): void {
    try {
      const canvas &#x3D; this.canvasElement?.nativeElement;
      if (!canvas) return;

      const ctx &#x3D; canvas.getContext(&#x27;2d&#x27;);
      if (!ctx) return;

      // Set canvas size to match video
      canvas.width &#x3D; element.videoWidth;
      canvas.height &#x3D; element.videoHeight;
      ctx.drawImage(element, 0, 0, canvas.width, canvas.height);

      // Get image data for quality assessment
      const imageData &#x3D; ctx.getImageData(0, 0, canvas.width, canvas.height);
      this.imageQuality &#x3D; assessImageQuality(imageData);

      // Update feedback
      this.qualityFeedbackMessage &#x3D; this.imageQuality.feedback;
      this.qualityRecommendations &#x3D; this.imageQuality.recommendations;
      this.showQualityFeedback &#x3D; this.imageQuality.quality &#x3D;&#x3D;&#x3D; &#x27;poor&#x27; || this.imageQuality.quality &#x3D;&#x3D;&#x3D; &#x27;fair&#x27;;

      // Emit quality change
      this.qualityChanged.emit(this.imageQuality);
    } catch (error) {
      console.error(&#x27;Image quality assessment failed:&#x27;, error);
    }
  }

  /**
   * Save recognized faces
   */
  private async saveRecognizedFaces(): Promise&lt;void&gt; {
    try {
      // Saving recognized faces
      // Here you would typically send the data to your backend
      // For now, we&#x27;ll just emit the event
      this.facesRecognized.emit(this.recognizedFaces);
    } catch (error) {
      console.error(&#x27;Failed to save recognized faces:&#x27;, error);
    }
  }

  /**
   * Check if current image quality is sufficient for group recognition
   */
  isQualitySufficient(): boolean {
    return this.imageQuality ? isImageQualitySufficientForGroup({
      data: new Uint8ClampedArray(),
      width: 0,
      height: 0,
      colorSpace: &#x27;srgb&#x27;
    } as ImageData) : false;
  }

  /**
   * Get quality status class for UI
   */
  getQualityStatusClass(): string {
    if (!this.imageQuality) return &#x27;quality-unknown&#x27;;

    switch (this.imageQuality.quality) {
      case &#x27;excellent&#x27;: return &#x27;quality-excellent&#x27;;
      case &#x27;good&#x27;: return &#x27;quality-good&#x27;;
      case &#x27;fair&#x27;: return &#x27;quality-fair&#x27;;
      case &#x27;poor&#x27;: return &#x27;quality-poor&#x27;;
      default: return &#x27;quality-unknown&#x27;;
    }
  }

  /**
   * Get quality status text for UI
   */
  getQualityStatusText(): string {
    if (!this.imageQuality) return &#x27;กำลังตรวจสอบ...&#x27;;

    switch (this.imageQuality.quality) {
      case &#x27;excellent&#x27;: return &#x27;คุณภาพดีเยี่ยม&#x27;;
      case &#x27;good&#x27;: return &#x27;คุณภาพดี&#x27;;
      case &#x27;fair&#x27;: return &#x27;คุณภาพปานกลาง&#x27;;
      case &#x27;poor&#x27;: return &#x27;คุณภาพต่ำ&#x27;;
      default: return &#x27;ไม่ทราบ&#x27;;
    }
  }

  /**
   * Toggle detection mode
   */
  toggleDetection(): void {
    if (this.autoDetect) {
      this.stopDetection();
    } else {
      this.startDetection();
    }
    this.autoDetect &#x3D; !this.autoDetect;
  }

  /**
   * Clear all recognized faces
   */
  clearRecognizedFaces(): void {
    this.recognizedFaces &#x3D; [];
    this.currentRecognitions &#x3D; [];
    this.facesRecognized.emit([]);
  }

  /**
   * Export recognized faces data
   */
  exportRecognizedFaces(): void {
    const data &#x3D; JSON.stringify(this.recognizedFaces, null, 2);
    const blob &#x3D; new Blob([data], { type: &#x27;application/json&#x27; });
    const url &#x3D; URL.createObjectURL(blob);
    const a &#x3D; document.createElement(&#x27;a&#x27;);
    a.href &#x3D; url;
    a.download &#x3D; &#x60;group-recognition-${new Date().toISOString().split(&#x27;T&#x27;)[0]}.json&#x60;;
    a.click();
    URL.revokeObjectURL(url);
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'GroupRecognitionResult.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
