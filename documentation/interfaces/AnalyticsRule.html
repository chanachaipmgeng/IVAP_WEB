<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>frontend documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>
          <script>
              // --- Iframe navigation tracking for Template Playground ---
              function sendCurrentUrlToParent() {
                  if (window.parent && window.parent !== window) {
                      window.parent.postMessage({
                          type: 'compodoc-iframe-navigate',
                          url: window.location.pathname + window.location.hash
                      }, '*');
                  }
              }
              window.addEventListener('hashchange', sendCurrentUrlToParent, false);
              window.addEventListener('popstate', sendCurrentUrlToParent, false);
              window.addEventListener('DOMContentLoaded', sendCurrentUrlToParent, false);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">frontend documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">

















<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  AnalyticsRule</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/core/services/video-analytics.service.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#actions" 
>
                                            actions
                                        </a>
                                </li>
                                <li>
                                        <a href="#conditions" 
>
                                            conditions
                                        </a>
                                </li>
                                <li>
                                        <a href="#createdAt" 
>
                                            createdAt
                                        </a>
                                </li>
                                <li>
                                        <a href="#description" 
>
                                            description
                                        </a>
                                </li>
                                <li>
                                        <a href="#enabled" 
>
                                            enabled
                                        </a>
                                </li>
                                <li>
                                        <a href="#id" 
>
                                            id
                                        </a>
                                </li>
                                <li>
                                        <a href="#name" 
>
                                            name
                                        </a>
                                </li>
                                <li>
                                        <a href="#sensitivity" 
>
                                            sensitivity
                                        </a>
                                </li>
                                <li>
                                        <a href="#type" 
>
                                            type
                                        </a>
                                </li>
                                <li>
                                        <a href="#updatedAt" 
>
                                            updatedAt
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="actions"></a>
                                        <span class="name "><b>actions</b>
                                            <a href="#actions">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>actions:     <code>literal type[]</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>literal type[]</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="conditions"></a>
                                        <span class="name "><b>conditions</b>
                                            <a href="#conditions">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>conditions:     <code>literal type</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>literal type</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="createdAt"></a>
                                        <span class="name "><b>createdAt</b>
                                            <a href="#createdAt">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>createdAt:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="description"></a>
                                        <span class="name "><b>description</b>
                                            <a href="#description">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>description:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="enabled"></a>
                                        <span class="name "><b>enabled</b>
                                            <a href="#enabled">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>enabled:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="id"></a>
                                        <span class="name "><b>id</b>
                                            <a href="#id">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name "><b>name</b>
                                            <a href="#name">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="sensitivity"></a>
                                        <span class="name "><b>sensitivity</b>
                                            <a href="#sensitivity">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>sensitivity:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="type"></a>
                                        <span class="name "><b>type</b>
                                            <a href="#type">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>type:     <code>&quot;motion&quot; | &quot;face&quot; | &quot;object&quot; | &quot;vehicle&quot; | &quot;person&quot; | &quot;anomaly&quot; | &quot;safety&quot;</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>&quot;motion&quot; | &quot;face&quot; | &quot;object&quot; | &quot;vehicle&quot; | &quot;person&quot; | &quot;anomaly&quot; | &quot;safety&quot;</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="updatedAt"></a>
                                        <span class="name "><b>updatedAt</b>
                                            <a href="#updatedAt">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>updatedAt:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" target="_blank" >Date</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, signal, computed } from &#x27;@angular/core&#x27;;
import { Observable, Subject } from &#x27;rxjs&#x27;;

export interface VideoStream {
  id: string;
  name: string;
  url: string;
  status: &#x27;active&#x27; | &#x27;inactive&#x27; | &#x27;error&#x27;;
  resolution: {
    width: number;
    height: number;
  };
  fps: number;
  bitrate: number;
  lastFrame?: string;
  timestamp: Date;
}

export interface AnalyticsEvent {
  id: string;
  streamId: string;
  type: &#x27;motion&#x27; | &#x27;face&#x27; | &#x27;object&#x27; | &#x27;vehicle&#x27; | &#x27;person&#x27; | &#x27;anomaly&#x27; | &#x27;safety&#x27;;
  confidence: number;
  boundingBox: {
    x: number;
    y: number;
    width: number;
    height: number;
  };
  metadata: {
    [key: string]: any;
  };
  timestamp: Date;
  processed: boolean;
}

export interface AnalyticsRule {
  id: string;
  name: string;
  description: string;
  type: &#x27;motion&#x27; | &#x27;face&#x27; | &#x27;object&#x27; | &#x27;vehicle&#x27; | &#x27;person&#x27; | &#x27;anomaly&#x27; | &#x27;safety&#x27;;
  enabled: boolean;
  sensitivity: number; // 0-100
  conditions: {
    [key: string]: any;
  };
  actions: {
    type: &#x27;alert&#x27; | &#x27;notification&#x27; | &#x27;recording&#x27; | &#x27;email&#x27; | &#x27;webhook&#x27;;
    config: {
      [key: string]: any;
    };
  }[];
  createdAt: Date;
  updatedAt: Date;
}

export interface AnalyticsStats {
  totalEvents: number;
  eventsByType: { [key: string]: number };
  eventsByStream: { [key: string]: number };
  averageConfidence: number;
  processingTime: number;
  lastProcessed: Date | null;
  errorRate: number;
}

export interface VideoAnalyticsConfig {
  enabled: boolean;
  processingInterval: number; // milliseconds
  maxConcurrentStreams: number;
  qualityThreshold: number; // 0-100
  storageRetention: number; // days
  realTimeProcessing: boolean;
  batchProcessing: boolean;
  batchSize: number;
  compressionEnabled: boolean;
  compressionQuality: number; // 0-100
}

@Injectable({
  providedIn: &#x27;root&#x27;
})
export class VideoAnalyticsService {
  private streamsMap: Map&lt;string, VideoStream&gt; &#x3D; new Map();
  private eventsMap: Map&lt;string, AnalyticsEvent&gt; &#x3D; new Map();
  private rulesMap: Map&lt;string, AnalyticsRule&gt; &#x3D; new Map();
  private configData: VideoAnalyticsConfig &#x3D; this.getDefaultConfig();
  private isProcessing &#x3D; false;
  private processingInterval: any &#x3D; null;

  // ✅ Signals for reactive state
  private _streams &#x3D; signal&lt;VideoStream[]&gt;([]);
  private _events &#x3D; signal&lt;AnalyticsEvent[]&gt;([]);
  private _rules &#x3D; signal&lt;AnalyticsRule[]&gt;([]);
  private _stats &#x3D; signal&lt;AnalyticsStats&gt;(this.getInitialStats());
  private _config &#x3D; signal&lt;VideoAnalyticsConfig&gt;(this.configData);

  // ✅ Readonly signals for public access
  public readonly streams &#x3D; this._streams.asReadonly();
  public readonly events &#x3D; this._events.asReadonly();
  public readonly rules &#x3D; this._rules.asReadonly();
  public readonly stats &#x3D; this._stats.asReadonly();
  public readonly config &#x3D; this._config.asReadonly();

  // ✅ Computed signals for derived state
  public readonly streamsCount &#x3D; computed(() &#x3D;&gt; this._streams().length);
  public readonly activeStreamsCount &#x3D; computed(() &#x3D;&gt; this._streams().filter(s &#x3D;&gt; s.status &#x3D;&#x3D;&#x3D; &#x27;active&#x27;).length);
  public readonly eventsCount &#x3D; computed(() &#x3D;&gt; this._events().length);
  public readonly rulesCount &#x3D; computed(() &#x3D;&gt; this._rules().length);

  // ✅ Real-time events (keep using Subject - not BehaviorSubject)
  private newEventSubject &#x3D; new Subject&lt;AnalyticsEvent&gt;();
  private streamStatusSubject &#x3D; new Subject&lt;{ streamId: string; status: string }&gt;();
  private alertSubject &#x3D; new Subject&lt;{ type: string; message: string; data: any }&gt;();

  public newEvent$ &#x3D; this.newEventSubject.asObservable();
  public streamStatus$ &#x3D; this.streamStatusSubject.asObservable();
  public alert$ &#x3D; this.alertSubject.asObservable();

  constructor() {
    this.initializeService();
  }

  /**
   * Initialize service
   */
  private initializeService(): void {
    this.loadConfig();
    this.loadRules();
    this.startProcessing();
  }

  /**
   * Get default configuration
   */
  private getDefaultConfig(): VideoAnalyticsConfig {
    return {
      enabled: true,
      processingInterval: 100, // 100ms
      maxConcurrentStreams: 10,
      qualityThreshold: 80,
      storageRetention: 30,
      realTimeProcessing: true,
      batchProcessing: false,
      batchSize: 100,
      compressionEnabled: true,
      compressionQuality: 80
    };
  }

  /**
   * Get initial stats
   */
  private getInitialStats(): AnalyticsStats {
    return {
      totalEvents: 0,
      eventsByType: {},
      eventsByStream: {},
      averageConfidence: 0,
      processingTime: 0,
      lastProcessed: null,
      errorRate: 0
    };
  }

  /**
   * Load configuration
   */
  private loadConfig(): void {
    try {
      const stored &#x3D; localStorage.getItem(&#x27;video_analytics_config&#x27;);
      if (stored) {
        this.configData &#x3D; { ...this.configData, ...JSON.parse(stored) };
        this._config.set(this.configData);
      }
    } catch (error) {
      console.error(&#x27;Failed to load video analytics config:&#x27;, error);
    }
  }

  /**
   * Save configuration
   */
  private saveConfig(): void {
    try {
      localStorage.setItem(&#x27;video_analytics_config&#x27;, JSON.stringify(this.configData));
    } catch (error) {
      console.error(&#x27;Failed to save video analytics config:&#x27;, error);
    }
  }

  /**
   * Load rules
   */
  private loadRules(): void {
    try {
      const stored &#x3D; localStorage.getItem(&#x27;video_analytics_rules&#x27;);
      if (stored) {
        const rules &#x3D; JSON.parse(stored);
        rules.forEach((rule: any) &#x3D;&gt; {
          rule.createdAt &#x3D; new Date(rule.createdAt);
          rule.updatedAt &#x3D; new Date(rule.updatedAt);
          this.rulesMap.set(rule.id, rule);
        });
        this._rules.set(Array.from(this.rulesMap.values()));
      }
    } catch (error) {
      console.error(&#x27;Failed to load video analytics rules:&#x27;, error);
    }
  }

  /**
   * Save rules
   */
  private saveRules(): void {
    try {
      const rules &#x3D; Array.from(this.rulesMap.values());
      localStorage.setItem(&#x27;video_analytics_rules&#x27;, JSON.stringify(rules));
    } catch (error) {
      console.error(&#x27;Failed to save video analytics rules:&#x27;, error);
    }
  }

  /**
   * Start processing
   */
  private startProcessing(): void {
    if (this.configData.enabled &amp;&amp; !this.isProcessing) {
      this.isProcessing &#x3D; true;
      this.processingInterval &#x3D; setInterval(() &#x3D;&gt; {
        this.processStreams();
      }, this.configData.processingInterval);
    }
  }

  /**
   * Stop processing
   */
  private stopProcessing(): void {
    if (this.processingInterval) {
      clearInterval(this.processingInterval);
      this.processingInterval &#x3D; null;
    }
    this.isProcessing &#x3D; false;
  }

  /**
   * Process video streams
   */
  private async processStreams(): Promise&lt;void&gt; {
    if (!this.configData.enabled) return;

    const startTime &#x3D; performance.now();
    const activeStreams &#x3D; Array.from(this.streamsMap.values()).filter(stream &#x3D;&gt; stream.status &#x3D;&#x3D;&#x3D; &#x27;active&#x27;);

    for (const stream of activeStreams) {
      try {
        await this.processStream(stream);
      } catch (error) {
        console.error(&#x60;Failed to process stream ${stream.id}:&#x60;, error);
        this.updateStreamStatus(stream.id, &#x27;error&#x27;);
      }
    }

    const processingTime &#x3D; performance.now() - startTime;
    this.updateStats({ processingTime });
  }

  /**
   * Process individual stream
   */
  private async processStream(stream: VideoStream): Promise&lt;void&gt; {
    // Simulate video processing
    const events &#x3D; await this.detectEvents(stream);

    for (const event of events) {
      await this.processEvent(event);
    }
  }

  /**
   * Detect events in stream
   */
  private async detectEvents(stream: VideoStream): Promise&lt;AnalyticsEvent[]&gt; {
    // Simulate AI detection
    const events: AnalyticsEvent[] &#x3D; [];
    const rules &#x3D; Array.from(this.rulesMap.values()).filter(rule &#x3D;&gt; rule.enabled);

    for (const rule of rules) {
      if (Math.random() &lt; rule.sensitivity / 100) {
        const event: AnalyticsEvent &#x3D; {
          id: this.generateId(),
          streamId: stream.id,
          type: rule.type,
          confidence: Math.random() * 100,
          boundingBox: {
            x: Math.random() * (stream.resolution.width - 100),
            y: Math.random() * (stream.resolution.height - 100),
            width: 50 + Math.random() * 100,
            height: 50 + Math.random() * 100
          },
          metadata: {
            ruleId: rule.id,
            ruleName: rule.name,
            timestamp: new Date().toISOString()
          },
          timestamp: new Date(),
          processed: false
        };

        events.push(event);
      }
    }

    return events;
  }

  /**
   * Process detected event
   */
  private async processEvent(event: AnalyticsEvent): Promise&lt;void&gt; {
    // Store event
    this.eventsMap.set(event.id, event);
    this._events.set(Array.from(this.eventsMap.values()));

    // Emit new event
    this.newEventSubject.next(event);

    // Find matching rules
    const rules &#x3D; Array.from(this.rulesMap.values()).filter(rule &#x3D;&gt;
      rule.enabled &amp;&amp; rule.type &#x3D;&#x3D;&#x3D; event.type
    );

    // Execute rule actions
    for (const rule of rules) {
      if (this.evaluateRule(rule, event)) {
        await this.executeRuleActions(rule, event);
      }
    }

    // Update stats
    this.updateStats();
  }

  /**
   * Evaluate rule conditions
   */
  private evaluateRule(rule: AnalyticsRule, event: AnalyticsEvent): boolean {
    // Simple evaluation - in real implementation, this would be more complex
    return event.confidence &gt;&#x3D; rule.sensitivity;
  }

  /**
   * Execute rule actions
   */
  private async executeRuleActions(rule: AnalyticsRule, event: AnalyticsEvent): Promise&lt;void&gt; {
    for (const action of rule.actions) {
      switch (action.type) {
        case &#x27;alert&#x27;:
          this.alertSubject.next({
            type: &#x27;alert&#x27;,
            message: &#x60;Rule &quot;${rule.name}&quot; triggered&#x60;,
            data: { rule, event }
          });
          break;
        case &#x27;notification&#x27;:
          // Send notification
          break;
        case &#x27;recording&#x27;:
          // Start recording
          break;
        case &#x27;email&#x27;:
          // Send email
          break;
        case &#x27;webhook&#x27;:
          // Send webhook
          break;
      }
    }
  }

  /**
   * Add video stream
   */
  public addStream(stream: Omit&lt;VideoStream, &#x27;id&#x27; | &#x27;timestamp&#x27;&gt;): string {
    const id &#x3D; this.generateId();
    const newStream: VideoStream &#x3D; {
      ...stream,
      id,
      timestamp: new Date()
    };

    this.streamsMap.set(id, newStream);
    this._streams.set(Array.from(this.streamsMap.values()));
    return id;
  }

  /**
   * Update stream
   */
  public updateStream(id: string, updates: Partial&lt;VideoStream&gt;): void {
    const stream &#x3D; this.streamsMap.get(id);
    if (stream) {
      const updatedStream &#x3D; { ...stream, ...updates };
      this.streamsMap.set(id, updatedStream);
      this._streams.set(Array.from(this.streamsMap.values()));
    }
  }

  /**
   * Remove stream
   */
  public removeStream(id: string): void {
    this.streamsMap.delete(id);
    this._streams.set(Array.from(this.streamsMap.values()));
  }

  /**
   * Update stream status
   */
  private updateStreamStatus(streamId: string, status: string): void {
    this.updateStream(streamId, { status: status as any });
    this.streamStatusSubject.next({ streamId, status });
  }

  /**
   * Add analytics rule
   */
  public addRule(rule: Omit&lt;AnalyticsRule, &#x27;id&#x27; | &#x27;createdAt&#x27; | &#x27;updatedAt&#x27;&gt;): string {
    const id &#x3D; this.generateId();
    const newRule: AnalyticsRule &#x3D; {
      ...rule,
      id,
      createdAt: new Date(),
      updatedAt: new Date()
    };

    this.rulesMap.set(id, newRule);
    this._rules.set(Array.from(this.rulesMap.values()));
    this.saveRules();
    return id;
  }

  /**
   * Update rule
   */
  public updateRule(id: string, updates: Partial&lt;AnalyticsRule&gt;): void {
    const rule &#x3D; this.rulesMap.get(id);
    if (rule) {
      const updatedRule &#x3D; { ...rule, ...updates, updatedAt: new Date() };
      this.rulesMap.set(id, updatedRule);
      this._rules.set(Array.from(this.rulesMap.values()));
      this.saveRules();
    }
  }

  /**
   * Remove rule
   */
  public removeRule(id: string): void {
    this.rulesMap.delete(id);
    this._rules.set(Array.from(this.rulesMap.values()));
    this.saveRules();
  }

  /**
   * Update configuration
   */
  public updateConfig(updates: Partial&lt;VideoAnalyticsConfig&gt;): void {
    this.configData &#x3D; { ...this.configData, ...updates };
    this._config.set(this.configData);
    this.saveConfig();

    // Restart processing if needed
    if (updates.enabled !&#x3D;&#x3D; undefined) {
      if (updates.enabled) {
        this.startProcessing();
      } else {
        this.stopProcessing();
      }
    }
  }

  /**
   * Get events by stream
   */
  public getEventsByStream(streamId: string): AnalyticsEvent[] {
    return Array.from(this.eventsMap.values())
      .filter(event &#x3D;&gt; event.streamId &#x3D;&#x3D;&#x3D; streamId)
      .sort((a, b) &#x3D;&gt; b.timestamp.getTime() - a.timestamp.getTime());
  }

  /**
   * Get events by type
   */
  public getEventsByType(type: string): AnalyticsEvent[] {
    return Array.from(this.eventsMap.values())
      .filter(event &#x3D;&gt; event.type &#x3D;&#x3D;&#x3D; type)
      .sort((a, b) &#x3D;&gt; b.timestamp.getTime() - a.timestamp.getTime());
  }

  /**
   * Get events by time range
   */
  public getEventsByTimeRange(start: Date, end: Date): AnalyticsEvent[] {
    return Array.from(this.eventsMap.values())
      .filter(event &#x3D;&gt; event.timestamp &gt;&#x3D; start &amp;&amp; event.timestamp &lt;&#x3D; end)
      .sort((a, b) &#x3D;&gt; b.timestamp.getTime() - a.timestamp.getTime());
  }

  /**
   * Clear events
   */
  public clearEvents(): void {
    this.eventsMap.clear();
    this._events.set([]);
    this.updateStats();
  }

  /**
   * Update statistics
   */
  private updateStats(updates?: Partial&lt;AnalyticsStats&gt;): void {
    const currentStats &#x3D; this._stats();
    const events &#x3D; Array.from(this.eventsMap.values());

    const newStats: AnalyticsStats &#x3D; {
      totalEvents: events.length,
      eventsByType: this.groupEventsByType(events),
      eventsByStream: this.groupEventsByStream(events),
      averageConfidence: this.calculateAverageConfidence(events),
      processingTime: updates?.processingTime || currentStats.processingTime,
      lastProcessed: new Date(),
      errorRate: this.calculateErrorRate()
    };

    this._stats.set(newStats);
  }

  /**
   * Group events by type
   */
  private groupEventsByType(events: AnalyticsEvent[]): { [key: string]: number } {
    return events.reduce((acc, event) &#x3D;&gt; {
      acc[event.type] &#x3D; (acc[event.type] || 0) + 1;
      return acc;
    }, {} as { [key: string]: number });
  }

  /**
   * Group events by stream
   */
  private groupEventsByStream(events: AnalyticsEvent[]): { [key: string]: number } {
    return events.reduce((acc, event) &#x3D;&gt; {
      acc[event.streamId] &#x3D; (acc[event.streamId] || 0) + 1;
      return acc;
    }, {} as { [key: string]: number });
  }

  /**
   * Calculate average confidence
   */
  private calculateAverageConfidence(events: AnalyticsEvent[]): number {
    if (events.length &#x3D;&#x3D;&#x3D; 0) return 0;
    const total &#x3D; events.reduce((sum, event) &#x3D;&gt; sum + event.confidence, 0);
    return total / events.length;
  }

  /**
   * Calculate error rate
   */
  private calculateErrorRate(): number {
    // Simple error rate calculation
    return Math.random() * 5; // 0-5%
  }

  /**
   * Get current configuration
   */
  public getConfig(): VideoAnalyticsConfig {
    return { ...this.configData };
  }

  /**
   * Get current statistics
   */
  public getStats(): AnalyticsStats {
    return this._stats();
  }

  /**
   * Check if processing is active
   */
  public isProcessingActive(): boolean {
    return this.isProcessing;
  }

  /**
   * Generate unique ID
   */
  private generateId(): string {
    return &#x27;va_&#x27; + Date.now() + &#x27;_&#x27; + Math.random().toString(36).substr(2, 9);
  }

  /**
   * Cleanup resources
   */
  public cleanup(): void {
    this.stopProcessing();
    this.streamsMap.clear();
    this.eventsMap.clear();
    this.rulesMap.clear();
  }
}

</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'AnalyticsRule.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
