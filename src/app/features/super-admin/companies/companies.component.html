<app-page-layout
  title="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó"
  description="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö"
  icon="üè¢"
  [actions]="pageActions()">

  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <div class="glass-card p-4">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
          <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ totalRecords() }}</p>
        </div>
        <div class="text-3xl">üè¢</div>
      </div>
    </div>
    <div class="glass-card p-4">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥</p>
          <p class="text-2xl font-bold text-green-600">{{ activeCompaniesCount() }}</p>
        </div>
        <div class="text-3xl">‚úÖ</div>
      </div>
    </div>
    <div class="glass-card p-4">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
          <p class="text-2xl font-bold text-yellow-600">{{ pendingCompaniesCount() }}</p>
        </div>
        <div class="text-3xl">‚è≥</div>
      </div>
    </div>
    <div class="glass-card p-4">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600 dark:text-gray-400">‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</p>
          <p class="text-2xl font-bold text-blue-600">{{ companies().length }}</p>
        </div>
        <div class="text-3xl">üìÑ</div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <app-filter-section
    [fields]="filterFields()"
    [columns]="2"
    (filterChange)="onFilterChange($event)"
  />

  <!-- Bulk Actions Toolbar -->
  @if (selectedCompanies().length > 0) {
    <div class="glass-card p-4 mb-4" role="toolbar" aria-label="‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°">
      <div class="flex items-center justify-between mb-2">
        <div class="flex items-center gap-4">
          <span class="text-sm font-medium text-gray-700 dark:text-gray-300">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: <strong>{{ selectedCompanies().length }}</strong>
          </span>
          <div class="flex gap-2">
            <app-glass-button
              variant="primary"
              size="sm"
              (clicked)="bulkActivate()"
              [disabled]="bulkOperationInProgress()"
              aria-label="‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
              ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            </app-glass-button>
            <app-glass-button
              variant="secondary"
              size="sm"
              (clicked)="bulkDeactivate()"
              [disabled]="bulkOperationInProgress()"
              aria-label="‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
              ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            </app-glass-button>
            <app-glass-button
              variant="danger"
              size="sm"
              (clicked)="bulkDelete()"
              [disabled]="bulkOperationInProgress()"
              aria-label="‡∏•‡∏ö">
              ‡∏•‡∏ö
            </app-glass-button>
          </div>
        </div>
        <app-glass-button
          variant="secondary"
          size="sm"
          (clicked)="clearSelection()"
          [disabled]="bulkOperationInProgress()"
          aria-label="‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å">
          ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        </app-glass-button>
      </div>
      <!-- Bulk Operation Progress Bar -->
      @if (bulkOperationInProgress()) {
        <div class="mt-2">
          <div class="w-full bg-gray-200 rounded-full h-2 dark:bg-gray-700">
            <div
              class="bg-blue-600 h-2 rounded-full transition-all duration-300"
              [style.width.%]="bulkOperationProgress()"
              [attr.aria-valuenow]="bulkOperationProgress()"
              [attr.aria-valuemin]="0"
              [attr.aria-valuemax]="100"
              role="progressbar"
              aria-label="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£"
            ></div>
          </div>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            {{ bulkOperationProgress() }}% ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
          </p>
        </div>
      }
    </div>
  }

  <!-- Companies Table -->
  <app-data-table
    [columns]="columns"
    [data]="companies()"
    [actions]="actions"
    [selectable]="true"
    [getRowId]="getRowId"
    [loading]="loading()"
    [enableColumnFilters]="true"
    [enableMultiSort]="true"
    emptyText="‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó"
    emptyIcon="üè¢"
    (sorted)="onSort($event)"
    (selectionChange)="onSelectionChange($event)"
    (filterChange)="onColumnFilterChange($event)">
    <div actions>
      <app-glass-button variant="secondary" (clicked)="exportCompanies()">
        ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      </app-glass-button>
    </div>
  </app-data-table>

  <!-- Pagination Controls -->
  <div class="flex items-center justify-between mt-4 text-gray-600 dark:text-gray-400">
    <div class="text-sm">
      ‡πÅ‡∏™‡∏î‡∏á {{ (currentPage() - 1) * pageSize() + 1 }} - {{ currentPage() * pageSize() > totalRecords() ? totalRecords() : currentPage() * pageSize() }} ‡∏à‡∏≤‡∏Å {{ totalRecords() }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    </div>
    <div class="flex items-center gap-2">
      <app-glass-button [disabled]="currentPage() === 1" (clicked)="onPageChange(currentPage() - 1)">
        ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
      </app-glass-button>
      <span class="font-semibold">‡∏´‡∏ô‡πâ‡∏≤ {{ currentPage() }} ‡∏à‡∏≤‡∏Å {{ totalPages() }}</span>
      <app-glass-button [disabled]="currentPage() === totalPages()" (clicked)="onPageChange(currentPage() + 1)">
        ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
      </app-glass-button>
    </div>
  </div>

  <!-- Add/Edit Company Modal -->
  <app-modal
    [isOpen]="showModal()"
    [title]="(editingCompany() ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏´‡∏°‡πà')"
    [loading]="saving()"
    [config]="{ size: 'xl', scrollable: true, centered: true, animation: true }"
    (closed)="closeModal()"
  >
    <div class="modal-form-container">
      <!-- Basic Information Section -->
      <div class="form-section">
        <h3 class="form-section-title">
          ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
        </h3>
        <div class="form-grid">
          <!-- Company Name - Full Width -->
          <div class="form-group form-group-full">
            <label class="form-label">
              ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
              <span class="required-indicator">*</span>
            </label>
            <input
              [(ngModel)]="formData.company_name"
              type="text"
              class="glass-input w-full"
              placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó"
              required
              aria-label="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó"
              aria-required="true"
            />
          </div>

          <!-- Company Logo - Full Width -->
          <div class="form-group form-group-full">
            <label class="form-label">
              ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
            </label>
            <div class="flex items-center gap-4">
              <div class="relative w-24 h-24 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 flex items-center justify-center">
                @if (formData.picture) {
                  <img appImageOptimization [ngSrc]="getImageUrl(formData.picture)" alt="Company Logo" class="w-full h-full object-cover" loading="lazy">
                }
                @if (!formData.picture) {
                  <span class="text-2xl">üè¢</span>
                }
                @if (uploadingImage()) {
                  <div class="absolute inset-0 bg-black/50 flex items-center justify-center">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-white"></div>
                  </div>
                }
              </div>
              <div class="flex-1">
                <input
                  type="file"
                  (change)="onFileSelected($event)"
                  accept="image/*"
                  class="block w-full text-sm text-gray-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-full file:border-0
                    file:text-sm file:font-semibold
                    file:bg-blue-50 file:text-blue-700
                    hover:file:bg-blue-100
                    dark:file:bg-blue-900/30 dark:file:text-blue-400"
                  aria-label="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó"
                  [disabled]="uploadingImage()"
                />
                <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                  PNG, JPG up to 5MB
                </p>
                <!-- Upload Progress Bar -->
                @if (uploadingImage()) {
                  <div class="mt-2">
                    <div class="w-full bg-gray-200 rounded-full h-2 dark:bg-gray-700">
                      <div
                        class="bg-blue-600 h-2 rounded-full transition-all duration-300"
                        [style.width.%]="uploadProgress()"
                        [attr.aria-valuenow]="uploadProgress()"
                        [attr.aria-valuemin]="0"
                        [attr.aria-valuemax]="100"
                        role="progressbar"
                      ></div>
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                      {{ uploadProgress() }}% ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
                    </p>
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- Company Code and Owner Name - Two Columns -->
          <div class="form-group">
            <label class="form-label">
              ‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
              <span class="required-indicator">*</span>
            </label>
            <input
              [(ngModel)]="formData.company_code"
              type="text"
              class="glass-input w-full"
              placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó"
              required
              aria-label="‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó"
              aria-required="true"
            />
          </div>

          <div class="form-group">
            <label class="form-label">
              ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
              <span class="required-indicator">*</span>
            </label>
            <input
              [(ngModel)]="formData.owner_name"
              type="text"
              class="glass-input w-full"
              placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•"
              required
              aria-label="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•"
              aria-required="true"
            />
          </div>

          <!-- Contact - Full Width -->
          <div class="form-group form-group-full">
            <label class="form-label">
              ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
              <span class="required-indicator">*</span>
            </label>
            <input
              [(ngModel)]="formData.contact"
              type="text"
              class="glass-input w-full"
              placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå"
              required
              aria-label="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå"
              aria-required="true"
            />
            <p class="form-hint">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</p>
          </div>

          <!-- Description - Full Width -->
          <div class="form-group form-group-full">
            <label class="form-label">
              ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
            </label>
            <textarea
              [(ngModel)]="formData.company_info"
              class="glass-input w-full"
              rows="3"
              placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"
            ></textarea>
          </div>
        </div>
      </div>

      <!-- Location Information Section -->
      <div class="form-section">
        <h3 class="form-section-title">
          ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á
        </h3>
        <div class="form-grid">
          <!-- Address - Full Width -->
          <div class="form-group form-group-full">
            <label class="form-label">
              ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
              <span class="required-indicator">*</span>
            </label>
            <textarea
              [(ngModel)]="formData.address"
              class="glass-input w-full"
              rows="2"
              placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà"
              required
            ></textarea>
          </div>

          <!-- Latitude and Longitude - Two Columns -->
          <div class="form-group">
            <label class="form-label">
              ‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î
              <span class="required-indicator">*</span>
            </label>
            <input
              [(ngModel)]="formData.latitude"
              type="number"
              step="any"
              min="-90"
              max="90"
              class="glass-input w-full"
              placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î"
              aria-label="‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î"
              aria-required="true"
              aria-describedby="latitude-hint"
            />
            <p id="latitude-hint" class="form-hint text-xs text-gray-500 dark:text-gray-400 mt-1">
              ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î (-90 ‡∏ñ‡∏∂‡∏á 90)
            </p>
          </div>

          <div class="form-group">
            <label class="form-label">
              ‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î
              <span class="required-indicator">*</span>
            </label>
            <input
              [(ngModel)]="formData.longitude"
              type="number"
              step="any"
              min="-180"
              max="180"
              class="glass-input w-full"
              placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î"
              required
              aria-label="‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î"
              aria-required="true"
              aria-describedby="longitude-hint"
            />
            <p id="longitude-hint" class="form-hint text-xs text-gray-500 dark:text-gray-400 mt-1">
              ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î (-180 ‡∏ñ‡∏∂‡∏á 180)
            </p>
          </div>
        </div>
      </div>

      <!-- Status Section -->
      <div class="form-section">
        <h3 class="form-section-title">
          ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        </h3>
        <div class="form-grid">
          <!-- Status - Full Width -->
          <div class="form-group form-group-full">
            <label class="form-label">
              ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            </label>
            <select [(ngModel)]="formData.status" class="glass-input w-full">
              <option value="PENDING">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
              <option value="PUBLIC">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div slot="footer" class="modal-footer-actions">
      <app-glass-button variant="secondary" (clicked)="closeModal()">
        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      </app-glass-button>
      <app-glass-button variant="primary" [loading]="saving()" (clicked)="saveCompany()">
        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
      </app-glass-button>
    </div>
  </app-modal>

  <!-- Settings Modal -->
  <app-modal
    [isOpen]="showSettingsModal()"
    [title]="settingsModalTitle()"
    [loading]="saving()"
    [config]="{ size: 'xl', scrollable: true, centered: true, animation: true }"
    (closed)="closeSettingsModal()"
  >
    <div class="modal-form-container">
      <!-- Subscription & Limits Section -->
      <div class="form-section">
        <h3 class="form-section-title">
          ‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î
        </h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
            </label>
            <select [(ngModel)]="settings.subscription_type" class="glass-input w-full">
              <option value="trial">‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ</option>
              <option value="basic">‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</option>
              <option value="premium">‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°</option>
              <option value="enterprise">‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">
              ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
            </label>
            <input
              [(ngModel)]="settings.max_users"
              type="number"
              min="0"
              class="glass-input w-full"
              placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î"
            />
          </div>

          <div class="form-group">
            <label class="form-label">
              ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
            </label>
            <input
              [(ngModel)]="settings.max_devices"
              type="number"
              min="0"
              class="glass-input w-full"
              placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î"
            />
          </div>

          <div class="form-group">
            <label class="form-label">
              ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (GB)
            </label>
            <input
              [(ngModel)]="settings.max_storage_gb"
              type="number"
              min="0"
              class="glass-input w-full"
              placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î"
            />
          </div>
        </div>
      </div>

      <!-- Features Section -->
      <div class="form-section">
        <h3 class="form-section-title">
          ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
        </h3>
        <div class="form-grid">
          <div class="form-group form-group-full">
            <label class="form-label">
              ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå
            </label>
            <div class="flex flex-wrap gap-2">
              @for (feature of availableFeatures; track feature) {
                <label class="flex items-center gap-2 cursor-pointer">
                  <input
                    type="checkbox"
                    [checked]="isFeatureEnabled(feature)"
                    (change)="toggleFeature(feature, $any($event.target).checked)"
                    class="glass-checkbox"
                  />
                  <span>{{ feature }}</span>
                </label>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- General Settings Section -->
      <div class="form-section">
        <h3 class="form-section-title">
          ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
        </h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">
              ‡πÄ‡∏Ç‡∏ï‡πÄ‡∏ß‡∏•‡∏≤
            </label>
            <select [ngModel]="getTimezone()" (ngModelChange)="setTimezone($event)" class="glass-input w-full">
              <option value="UTC">UTC</option>
              <option value="Asia/Bangkok">Asia/Bangkok</option>
              <option value="America/New_York">America/New_York</option>
              <option value="Europe/London">Europe/London</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">
              ‡∏†‡∏≤‡∏©‡∏≤
            </label>
            <select [ngModel]="getLanguage()" (ngModelChange)="setLanguage($event)" class="glass-input w-full">
              <option value="en">English</option>
              <option value="th">‡πÑ‡∏ó‡∏¢</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">
              ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
            </label>
            <select [ngModel]="getDateFormat()" (ngModelChange)="setDateFormat($event)" class="glass-input w-full">
              <option value="YYYY-MM-DD">YYYY-MM-DD</option>
              <option value="DD/MM/YYYY">DD/MM/YYYY</option>
              <option value="MM/DD/YYYY">MM/DD/YYYY</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">
              ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
            </label>
            <select [ngModel]="getTimeFormat()" (ngModelChange)="setTimeFormat($event)" class="glass-input w-full">
              <option value="24h">24 Hour</option>
              <option value="12h">12 Hour</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Notification Settings Section -->
      <div class="form-section">
        <h3 class="form-section-title">
          ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        </h3>
        <div class="form-grid">
          <div class="form-group form-group-full">
            <div class="space-y-3">
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  [checked]="getNotifications().email"
                  (change)="setNotificationField('email', $any($event.target).checked)"
                  class="glass-checkbox"
                />
                <span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  [checked]="getNotifications().sms"
                  (change)="setNotificationField('sms', $any($event.target).checked)"
                  class="glass-checkbox"
                />
                <span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏á SMS</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  [checked]="getNotifications().push"
                  (change)="setNotificationField('push', $any($event.target).checked)"
                  class="glass-checkbox"
                />
                <span>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö Push</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  [checked]="getNotifications().webhook"
                  (change)="setNotificationField('webhook', $any($event.target).checked)"
                  class="glass-checkbox"
                />
                <span>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô Webhook</span>
              </label>
              @if (getNotifications().webhook) {
                <div class="form-group">
                  <label class="form-label">
                    URL Webhook
                  </label>
                  <input
                    [value]="getNotifications().webhookUrl || ''"
                    (input)="setNotificationField('webhookUrl', $any($event.target).value)"
                    type="url"
                    class="glass-input w-full"
                    placeholder="‡∏£‡∏∞‡∏ö‡∏∏ URL Webhook"
                  />
                </div>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Security Settings Section -->
      <div class="form-section">
        <h3 class="form-section-title">
          ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
        </h3>
        <div class="form-grid">
          <div class="form-group form-group-full">
            <label class="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                [checked]="getSecurity().twoFactorRequired"
                (change)="setSecurityField('twoFactorRequired', $any($event.target).checked)"
                class="glass-checkbox"
              />
              <span>‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ 2FA</span>
            </label>
          </div>

          <div class="form-group">
            <label class="form-label">
              ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô (‡∏ô‡∏≤‡∏ó‡∏µ)
            </label>
            <input
              [value]="getSecurity().sessionTimeout || 30"
              (input)="setSecurityField('sessionTimeout', +$any($event.target).value)"
              type="number"
              min="5"
              max="1440"
              class="glass-input w-full"
            />
          </div>

          <div class="form-group form-group-full">
            <label class="form-label">
              ‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
            </label>
            <div class="space-y-2 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  [checked]="getSecurity().passwordPolicy?.requireUppercase"
                  (change)="setPasswordPolicyField('requireUppercase', $any($event.target).checked)"
                  class="glass-checkbox"
                />
                <span>‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  [checked]="getSecurity().passwordPolicy?.requireLowercase"
                  (change)="setPasswordPolicyField('requireLowercase', $any($event.target).checked)"
                  class="glass-checkbox"
                />
                <span>‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  [checked]="getSecurity().passwordPolicy?.requireNumbers"
                  (change)="setPasswordPolicyField('requireNumbers', $any($event.target).checked)"
                  class="glass-checkbox"
                />
                <span>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  [checked]="getSecurity().passwordPolicy?.requireSpecialChars"
                  (change)="setPasswordPolicyField('requireSpecialChars', $any($event.target).checked)"
                  class="glass-checkbox"
                />
                <span>‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©</span>
              </label>
              <div class="form-group">
                <label class="form-label">
                  ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥
                </label>
                <input
                  [value]="getSecurity().passwordPolicy?.minLength || 8"
                  (input)="setPasswordPolicyField('minLength', +$any($event.target).value)"
                  type="number"
                  min="4"
                  max="128"
                  class="glass-input w-full"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div slot="footer" class="modal-footer-actions">
      <app-glass-button variant="secondary" (clicked)="closeSettingsModal()">
        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      </app-glass-button>
      <app-glass-button variant="primary" [loading]="saving()" (clicked)="saveSettings()">
        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
      </app-glass-button>
    </div>
  </app-modal>

  <!-- Company Details Modal -->
  <app-modal
    [isOpen]="showDetailsModal()"
    [title]="viewingCompany() ? ('‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó - ' + viewingCompany()!.company_name) : '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó'"
    [config]="{ size: 'lg', scrollable: true, centered: true, animation: true }"
    (closed)="closeDetailsModal()"
  >
    @if (viewingCompany()) {
      <div class="modal-form-container">
        <div class="form-section">
          <h3 class="form-section-title">
            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
          </h3>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label>
              <p class="form-value">{{ viewingCompany()!.company_name }}</p>
            </div>
            <div class="form-group">
              <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label>
              <p class="form-value">{{ viewingCompany()!.company_code }}</p>
            </div>
            <div class="form-group">
              <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</label>
              <p class="form-value">{{ viewingCompany()!.owner_name || 'N/A' }}</p>
            </div>
            <div class="form-group">
              <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
              <p class="form-value">{{ viewingCompany()!.contact || 'N/A' }}</p>
            </div>
            <div class="form-group form-group-full">
              <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
              <p class="form-value">{{ viewingCompany()!.company_info || 'N/A' }}</p>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3 class="form-section-title">
            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á
          </h3>
          <div class="form-grid">
            <div class="form-group form-group-full">
              <label class="form-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
              <p class="form-value">{{ viewingCompany()!.address }}</p>
            </div>
            <div class="form-group">
              <label class="form-label">‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î</label>
              <p class="form-value">{{ viewingCompany()!.latitude }}</p>
            </div>
            <div class="form-group">
              <label class="form-label">‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î</label>
              <p class="form-value">{{ viewingCompany()!.longitude }}</p>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3 class="form-section-title">
            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
          </h3>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
              <p class="form-value">
                <span [class]="getStatusClassForDisplay(viewingCompany()!.status)">
                  {{ getStatusDisplayText(viewingCompany()!.status) }}
                </span>
              </p>
            </div>
            <div class="form-group">
              <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</label>
              <p class="form-value">{{ viewingCompany()!.created_at ? formatDateTime(viewingCompany()!.created_at) : 'N/A' }}</p>
            </div>
            <div class="form-group">
              <label class="form-label">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</label>
              <p class="form-value">{{ viewingCompany()!.updated_at ? formatDateTime(viewingCompany()!.updated_at) : 'N/A' }}</p>
            </div>
          </div>
        </div>
      </div>
    }
    <div slot="footer" class="modal-footer-actions">
      <app-glass-button variant="secondary" (clicked)="closeDetailsModal()">
        ‡∏õ‡∏¥‡∏î
      </app-glass-button>
      @if (viewingCompany()) {
        <app-glass-button variant="primary" (clicked)="openEditModal(viewingCompany()!)">
          ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        </app-glass-button>
      }
    </div>
  </app-modal>
</app-page-layout>
