<app-page-layout [title]="'pages.departments.title' | translate"
  [subtitle]="'pages.departments.description' | translate" [actions]="pageActions()">

  <!-- Filter Section -->
  <app-filter-section [fields]="filterFields" [loading]="loading()" (search)="onSearch($event)"
    (filterChange)="onFilterChange($event)">
  </app-filter-section>

  <!-- Error Message -->
  @if (errorMessage()) {
  <div
    class="p-4 mb-4 bg-red-100 border border-red-300 rounded-lg text-red-800 dark:bg-red-900/20 dark:border-red-700 dark:text-red-400">
    {{ errorMessage() }}
  </div>
  }

  <!-- Loading State -->
  @if (loading()) {
  <div class="p-8 text-center text-gray-500 dark:text-gray-400">
    <p>{{ 'common.loading' | translate }}</p>
  </div>
  }

  <!-- Data Table -->
  @if (!loading() && departments().length > 0) {
  <app-data-table [data]="departments()" [columns]="columns" [actions]="actions" [pagination]="{
        currentPage: currentPage(),
        pageSize: pageSize(),
        total: totalRecords(),
        totalPages: totalPages()
      }" (pageChange)="onPageChange($event)" (pageSizeChange)="onPageSizeChange($event)">
  </app-data-table>
  }

  <!-- Empty State -->
  @if (!loading() && departments().length === 0) {
  <app-empty-state [title]="'pages.departments.noDepartmentsFound' | translate"
    [message]="'pages.departments.description' | translate" [actions]="emptyStateActions()">
  </app-empty-state>
  }

  <!-- Add/Edit Modal -->
  <app-modal [isOpen]="showModal()"
    [title]="editingDepartment() ? ('pages.departments.editDepartment' | translate) : ('pages.departments.addDepartment' | translate)"
    [loading]="saving()" (closed)="closeModal()">
    <app-modal-form [fields]="formFields()" [loading]="saving()" (submitted)="onFormSubmitted($event)"
      (cancelled)="closeModal()">
    </app-modal-form>
  </app-modal>

  <!-- Delete Confirmation Modal -->
  <app-modal [isOpen]="showDeleteModal()" [title]="'pages.departments.deleteDepartment' | translate"
    [loading]="deleting()" (closed)="cancelDelete()">
    <div class="p-4">
      <p class="mb-4 text-gray-700 dark:text-gray-300">Are you sure you want to delete <strong>{{
          deletingDepartment()?.th_name || deletingDepartment()?.eng_name }}</strong>?</p>
      <p class="text-red-600 font-medium mb-4">This action cannot be undone.</p>
      <div class="flex gap-3 justify-end mt-6">
        <app-glass-button variant="danger" [loading]="deleting()" (clicked)="deleteDepartment()">
          Delete
        </app-glass-button>
        <app-glass-button variant="secondary" [disabled]="deleting()" (clicked)="cancelDelete()">
          Cancel
        </app-glass-button>
      </div>
    </div>
  </app-modal>
</app-page-layout>