<app-page-layout
  [title]="'pages.visitors.title' | translate"
  [description]="'pages.visitors.description' | translate"
  icon="ðŸš¶"
  [actions]="pageActions()">
  
  <!-- Error Message -->
  @if (errorMessage()) {
    <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
      <p class="text-red-800 text-sm">{{ errorMessage() }}</p>
    </div>
  }

  <!-- Visitors Table -->
  <app-data-table
    [columns]="columns"
    [data]="visitors()"
    [actions]="actions"
    [searchable]="true"
  >
    <div actions>
      <app-glass-button (clicked)="loadVisitors()">
        ðŸ”„ {{ 'common.refresh' | translate }}
      </app-glass-button>
    </div>
  </app-data-table>

  <!-- Add/Edit Modal -->
  <app-modal
    [isOpen]="showModal()"
    [title]="(editingVisitor() ? ('pages.visitors.editVisitor' | translate) : ('pages.visitors.registerVisitor' | translate))"
    [loading]="saving()"
    (closed)="closeModal()"
    (confirmed)="saveVisitor()"
  >
    <form [formGroup]="visitorForm" class="space-y-4">
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
            {{ 'pages.visitors.firstName' | translate }} <span class="text-red-500">*</span>
          </label>
          <input
            formControlName="first_name"
            type="text"
            class="glass-input w-full"
            [class.border-red-300]="visitorForm.get('first_name')?.invalid && visitorForm.get('first_name')?.touched"
            [placeholder]="'pages.visitors.firstName' | translate"
          />
          @if (getFieldError('first_name')) {
            <p class="mt-1 text-sm text-red-600">{{ getFieldError('first_name') }}</p>
          }
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
            {{ 'pages.visitors.lastName' | translate }} <span class="text-red-500">*</span>
          </label>
          <input
            formControlName="last_name"
            type="text"
            class="glass-input w-full"
            [class.border-red-300]="visitorForm.get('last_name')?.invalid && visitorForm.get('last_name')?.touched"
            [placeholder]="'pages.visitors.lastName' | translate"
          />
          @if (getFieldError('last_name')) {
            <p class="mt-1 text-sm text-red-600">{{ getFieldError('last_name') }}</p>
          }
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          {{ 'pages.visitors.email' | translate }}
        </label>
        <input
          formControlName="email"
          type="email"
          class="glass-input w-full"
          [class.border-red-300]="visitorForm.get('email')?.invalid && visitorForm.get('email')?.touched"
          [placeholder]="'pages.visitors.email' | translate"
        />
        @if (getFieldError('email')) {
          <p class="mt-1 text-sm text-red-600">{{ getFieldError('email') }}</p>
        }
      </div>

      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          {{ 'pages.visitors.phone' | translate }}
        </label>
        <input
          formControlName="phone"
          type="tel"
          class="glass-input w-full"
          [class.border-red-300]="visitorForm.get('phone')?.invalid && visitorForm.get('phone')?.touched"
          [placeholder]="'pages.visitors.phone' | translate"
        />
        @if (getFieldError('phone')) {
          <p class="mt-1 text-sm text-red-600">{{ getFieldError('phone') }}</p>
        }
      </div>

      <div>
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          {{ 'pages.visitors.companyName' | translate }}
        </label>
        <input
          formControlName="company_name"
          type="text"
          class="glass-input w-full"
          [placeholder]="'pages.visitors.companyName' | translate"
        />
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
            {{ 'pages.visitors.visitorType' | translate }} <span class="text-red-500">*</span>
          </label>
          <select
            formControlName="visitor_type"
            class="glass-input w-full"
            [class.border-red-300]="visitorForm.get('visitor_type')?.invalid && visitorForm.get('visitor_type')?.touched"
          >
            <option [value]="VisitorType.GUEST">{{ 'pages.visitors.guest' | translate }}</option>
            <option [value]="VisitorType.VENDOR">{{ 'pages.visitors.vendor' | translate }}</option>
            <option [value]="VisitorType.CONTRACTOR">{{ 'pages.visitors.contractor' | translate }}</option>
          </select>
          @if (getFieldError('visitor_type')) {
            <p class="mt-1 text-sm text-red-600">{{ getFieldError('visitor_type') }}</p>
          }
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
            {{ 'pages.visitors.visitPurpose' | translate }} <span class="text-red-500">*</span>
          </label>
          <select
            formControlName="visit_purpose"
            class="glass-input w-full"
            [class.border-red-300]="visitorForm.get('visit_purpose')?.invalid && visitorForm.get('visit_purpose')?.touched"
          >
            <option [value]="VisitPurpose.MEETING">{{ 'pages.visitors.meeting' | translate }}</option>
            <option [value]="VisitPurpose.DELIVERY">{{ 'pages.visitors.delivery' | translate }}</option>
            <option [value]="VisitPurpose.INTERVIEW">{{ 'pages.visitors.interview' | translate }}</option>
            <option [value]="VisitPurpose.OTHER">{{ 'pages.visitors.other' | translate }}</option>
          </select>
          @if (getFieldError('visit_purpose')) {
            <p class="mt-1 text-sm text-red-600">{{ getFieldError('visit_purpose') }}</p>
          }
        </div>
      </div>

      @if (errorMessage()) {
        <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
          <p class="text-sm text-red-800">{{ errorMessage() }}</p>
        </div>
      }
    </form>
  </app-modal>
</app-page-layout>
