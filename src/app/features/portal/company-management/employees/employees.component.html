<app-page-layout
  title="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô"
  description="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó"
  icon="üë•"
  [actions]="pageActions()">
  
  <!-- Error Message -->
  @if (errorMessage()) {
    <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
      <p class="text-red-800 text-sm">{{ errorMessage() }}</p>
    </div>
  }

  <!-- Filters -->
  <app-filter-section
    [fields]="filterFields()"
    [columns]="1"
    (filterChange)="onFilterChange($event)"
  />

  <!-- Employees Table -->
  <app-data-table
    [columns]="columns"
    [data]="employees()"
    [actions]="actions"
    (sorted)="onSort($event)"
  >
  </app-data-table>

  <!-- Pagination Controls -->
  <div class="flex items-center justify-between mt-4 text-gray-600 dark:text-gray-400">
    <div class="text-sm">
      ‡πÅ‡∏™‡∏î‡∏á {{ (currentPage() - 1) * pageSize() + 1 }} - {{ currentPage() * pageSize() > totalRecords() ? totalRecords() : currentPage() * pageSize() }} ‡∏à‡∏≤‡∏Å {{ totalRecords() }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    </div>
    <div class="flex items-center gap-2">
      <app-glass-button [disabled]="currentPage() === 1" (clicked)="onPageChange(currentPage() - 1)">
        &laquo; ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
      </app-glass-button>
      <span class="font-semibold">‡∏´‡∏ô‡πâ‡∏≤ {{ currentPage() }} ‡∏à‡∏≤‡∏Å {{ totalPages() }}</span>
      <app-glass-button [disabled]="currentPage() === totalPages()" (clicked)="onPageChange(currentPage() + 1)">
        ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ &raquo;
      </app-glass-button>
    </div>
  </div>

  <!-- Add/Edit Modal Form -->
  <app-modal-form
    [isOpen]="showModal()"
    [title]="(editingEmployee() ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà')"
    [fields]="employeeFormFields()"
    [loading]="saving()"
    submitLabel="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å"
    cancelLabel="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
    (closed)="closeModal()"
    (submitted)="onFormSubmitted($event)"
    (fieldChange)="onFormFieldChange($event)"
  />

  <!-- Error Message Display -->
  @if (errorMessage() && showModal()) {
    <div class="p-3 bg-red-50 border border-red-200 rounded-lg mt-4">
      <p class="text-sm text-red-800">{{ errorMessage() }}</p>
    </div>
  }

  <!-- Empty State for Employees -->
  @if (employees().length === 0 && !loading()) {
    <app-empty-state
      icon="üë•"
      title="‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô"
      description="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤"
      [action]="{
        label: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
        icon: '‚ûï',
        variant: 'primary',
        onClick: openAddModal.bind(this)
      }"
    />
  }

  <!-- Delete Confirmation Modal -->
  <app-modal
    [isOpen]="showDeleteModal()"
    title="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö"
    [loading]="deleting()"
    (closed)="closeDeleteModal()"
  >
    <div class="p-4">
      <p class="text-gray-700 dark:text-gray-300 mb-4">
        ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô <strong>{{ deletingEmployee()?.first_name }} {{ deletingEmployee()?.last_name }}</strong> ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
      </p>
      <p class="text-red-600 dark:text-red-400 text-sm mb-4">
        ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ
      </p>
      <div class="flex justify-end gap-2">
        <app-glass-button
          variant="danger"
          [loading]="deleting()"
          (clicked)="confirmDelete()">
          ‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
        </app-glass-button>
        <app-glass-button
          variant="secondary"
          [disabled]="deleting()"
          (clicked)="closeDeleteModal()">
          ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        </app-glass-button>
      </div>
    </div>
  </app-modal>

  <!-- Face Enrollment Modal -->
  <app-modal
    [isOpen]="showFaceEnrollModal()"
    [title]="'‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ - ' + (enrollingEmployee()?.first_name || '') + ' ' + (enrollingEmployee()?.last_name || '')"
    [loading]="enrollingFace()"
    (closed)="closeFaceEnrollModal()"
  >
    <div class="p-4">
      <p class="text-gray-700 dark:text-gray-300 mb-4">
        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤
      </p>
      
      <!-- File Upload -->
      <div class="mb-4">
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ <span class="text-red-500">*</span>
        </label>
        <input
          type="file"
          accept="image/*"
          (change)="onFaceImageSelected($event)"
          class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900 dark:file:text-blue-300"
          [disabled]="enrollingFace()"
        />
        @if (faceImageFile) {
          <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå: {{ faceImageFile.name }} ({{ (faceImageFile.size / 1024).toFixed(2) }} KB)
          </p>
        }
      </div>

      <!-- Error Message -->
      @if (errorMessage() && showFaceEnrollModal()) {
        <div class="p-3 bg-red-50 border border-red-200 rounded-lg mb-4">
          <p class="text-sm text-red-800">{{ errorMessage() }}</p>
        </div>
      }

      <!-- Actions -->
      <div class="flex justify-end gap-2">
        <app-glass-button
          variant="primary"
          [loading]="enrollingFace()"
          [disabled]="!faceImageFile || enrollingFace()"
          (clicked)="enrollFace()">
          üì∑ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤
        </app-glass-button>
        <app-glass-button
          variant="secondary"
          [disabled]="enrollingFace()"
          (clicked)="closeFaceEnrollModal()">
          ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        </app-glass-button>
      </div>
    </div>
  </app-modal>
</app-page-layout>
