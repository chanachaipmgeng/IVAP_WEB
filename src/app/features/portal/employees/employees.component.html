<app-page-layout
  [title]="'navigation.employees' | translate"
  [description]="'pages.employees.description' | translate"
  icon="üë•"
  [actions]="pageActions()">
  
  <!-- Error Message -->
  @if (errorMessage()) {
    <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
      <p class="text-red-800 text-sm">{{ errorMessage() }}</p>
    </div>
  }

  <!-- Filters -->
  <app-filter-section
    [fields]="filterFields()"
    [columns]="1"
    (filterChange)="onFilterChange($event)"
  />

  <!-- Employees Table -->
  <app-data-table
    [columns]="columns"
    [data]="employees()"
    [actions]="actions"
    (sorted)="onSort($event)"
  >
  </app-data-table>

  <!-- Pagination Controls -->
  <div class="flex items-center justify-between mt-4 text-gray-600 dark:text-gray-400">
    <div class="text-sm">
      {{ 'pages.employees.showingRecords' | translate }} {{ (currentPage() - 1) * pageSize() + 1 }} - {{ currentPage() * pageSize() > totalRecords() ? totalRecords() : currentPage() * pageSize() }} {{ 'common.of' | translate }} {{ totalRecords() }} {{ 'pages.employees.records' | translate }}
    </div>
    <div class="flex items-center gap-2">
      <app-glass-button [disabled]="currentPage() === 1" (clicked)="onPageChange(currentPage() - 1)">
        &laquo; {{ 'common.previous' | translate }}
      </app-glass-button>
      <span class="font-semibold">{{ 'common.page' | translate }} {{ currentPage() }} {{ 'common.of' | translate }} {{ totalPages() }}</span>
      <app-glass-button [disabled]="currentPage() === totalPages()" (clicked)="onPageChange(currentPage() + 1)">
        {{ 'common.next' | translate }} &raquo;
      </app-glass-button>
    </div>
  </div>

  <!-- Add/Edit Modal Form -->
  <app-modal-form
    [isOpen]="showModal()"
    [title]="(editingEmployee() ? ('pages.employees.editEmployee' | translate) : ('pages.employees.addEmployee' | translate))"
    [fields]="employeeFormFields()"
    [loading]="saving()"
    [submitLabel]="'common.save' | translate"
    [cancelLabel]="'common.cancel' | translate"
    (closed)="closeModal()"
    (submitted)="onFormSubmitted($event)"
    (fieldChange)="onFormFieldChange($event)"
  />

  <!-- Error Message Display -->
  @if (errorMessage() && showModal()) {
    <div class="p-3 bg-red-50 border border-red-200 rounded-lg mt-4">
      <p class="text-sm text-red-800">{{ errorMessage() }}</p>
    </div>
  }

  <!-- Empty State for Employees -->
  @if (employees().length === 0 && !loading()) {
    <app-empty-state
      icon="üë•"
      [title]="'common.emptyState.title' | translate"
      [description]="'pages.employees.noEmployeesFound' | translate"
      [action]="{
        label: ('pages.employees.addEmployee' | translate),
        icon: '‚ûï',
        variant: 'primary',
        onClick: openAddModal.bind(this)
      }"
    />
  }

  <!-- Delete Confirmation Modal -->
  <app-modal
    [isOpen]="showDeleteModal()"
    [title]="'pages.employees.confirmDelete' | translate"
    [loading]="deleting()"
    (closed)="closeDeleteModal()"
  >
    <div class="p-4">
      <p class="text-gray-700 dark:text-gray-300 mb-4">
        {{ 'pages.employees.deleteEmployeeConfirm' | translate }} <strong>{{ deletingEmployee()?.firstName }} {{ deletingEmployee()?.lastName }}</strong>?
      </p>
      <p class="text-red-600 dark:text-red-400 text-sm mb-4">
        {{ 'pages.employees.actionCannotBeUndone' | translate }}
      </p>
      <div class="flex justify-end gap-2">
        <app-glass-button
          variant="danger"
          [loading]="deleting()"
          (clicked)="confirmDelete()">
          {{ 'pages.employees.deleteEmployee' | translate }}
        </app-glass-button>
        <app-glass-button
          variant="secondary"
          [disabled]="deleting()"
          (clicked)="closeDeleteModal()">
          {{ 'common.cancel' | translate }}
        </app-glass-button>
      </div>
    </div>
  </app-modal>

  <!-- Face Enrollment Modal -->
  <app-modal
    [isOpen]="showFaceEnrollModal()"
    [title]="'Enroll Face - ' + (enrollingEmployee()?.firstName || '') + ' ' + (enrollingEmployee()?.lastName || '')"
    [loading]="enrollingFace()"
    (closed)="closeFaceEnrollModal()"
  >
    <div class="p-4">
      <p class="text-gray-700 dark:text-gray-300 mb-4">
        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Enroll Face
      </p>
      
      <!-- File Upload -->
      <div class="mb-4">
        <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
          ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ <span class="text-red-500">*</span>
        </label>
        <input
          type="file"
          accept="image/*"
          (change)="onFaceImageSelected($event)"
          class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900 dark:file:text-blue-300"
          [disabled]="enrollingFace()"
        />
        @if (faceImageFile) {
          <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå: {{ faceImageFile.name }} ({{ (faceImageFile.size / 1024).toFixed(2) }} KB)
          </p>
        }
      </div>

      <!-- Error Message -->
      @if (errorMessage() && showFaceEnrollModal()) {
        <div class="p-3 bg-red-50 border border-red-200 rounded-lg mb-4">
          <p class="text-sm text-red-800">{{ errorMessage() }}</p>
        </div>
      }

      <!-- Actions -->
      <div class="flex justify-end gap-2">
        <app-glass-button
          variant="primary"
          [loading]="enrollingFace()"
          [disabled]="!faceImageFile || enrollingFace()"
          (clicked)="enrollFace()">
          üì∑ Enroll Face
        </app-glass-button>
        <app-glass-button
          variant="secondary"
          [disabled]="enrollingFace()"
          (clicked)="closeFaceEnrollModal()">
          {{ 'common.cancel' | translate }}
        </app-glass-button>
      </div>
    </div>
  </app-modal>
</app-page-layout>
